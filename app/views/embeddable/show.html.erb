<% content_for :head do %>
  <script 
    type="module"
    src="https://embed.embeddable.com/js/v1/?region=us">
  </script>
<% end %>

<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard</h1>
    <p class="text-gray-600">Embedded analytics dashboard powered by Embeddable</p>
  </div>

  <div class="bg-white rounded-lg shadow-lg p-6">
    <div id="embeddable-container" class="w-full">
      <em-beddable
        id="dashboard-embed"
        token="<%= @embeddable_token["token"] %>"
        style="width: 100%; min-height: 600px;"
        class="embeddable-responsive"
      ></em-beddable>
    </div>
  </div>

  <div class="mt-6 text-sm text-gray-500">
    <p>Dashboard loaded via Embeddable web component</p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const embeddableElement = document.getElementById('dashboard-embed');
    const container = document.getElementById('embeddable-container');

    if (embeddableElement && container) {
      embeddableElement.addEventListener('loaded', function(event) {
        console.log('Embeddable dashboard loaded successfully');

        setTimeout(() => {
          const rect = embeddableElement.getBoundingClientRect();
          console.log('Embeddable final dimensions:', {
            width: rect.width,
            height: rect.height,
            scrollHeight: embeddableElement.scrollHeight
          });
        }, 500);
      });

      embeddableElement.addEventListener('error', function(event) {
        console.error('Error loading Embeddable dashboard:', event.detail);
      });

      const observer = new ResizeObserver(entries => {
        for (let entry of entries) {
          console.log('Container size changed:', {
            width: entry.contentRect.width,
            height: entry.contentRect.height
          });
        }
      });

      observer.observe(container);
    }
  });
</script>
