cubes:
  - name: commerce_subscriptions
    data_source: fluid-replica
    sql: |-
      SELECT * FROM public.commerce_subscriptions
      WHERE company_id = { COMPILE_CONTEXT.securityContext.company_id }

    dimensions:
      - name: id
        type: string
        sql: id
        primary_key: true
        public: true
      - name: created_at
        type: time
        sql: created_at
      - name: updated_at
        type: time
        sql: updated_at
      - name: customer_id
        type: number
        sql: customer_id
      - name: company_id
        type: number
        sql: customer_id
      - name: variant_id
        type: number
        sql: variant_id
      - name: address_id
        type: number
        sql: address_id
      - name: payment_method_id
        type: number
        sql: payment_method_id
      - name: currency_id
        type: number
        sql: currency_id
      - name: country_id
        type: number
        sql: country_id
      - name: next_bill_date
        type: time
        sql: next_bill_date
      - name: last_bill_date
        type: time
        sql: last_bill_date
      - name: next_ship_date
        type: time
        sql: next_ship_date
      - name: last_ship_date
        type: time
        sql: last_ship_date
      - name: status
        type: string
        sql: status
      - name: diabled
        type: boolean
        sql: disabled
      - name: quantity
        type: number
        sql: quantity
      - name: price
        type: number
        sql: price
      - name: origninal_price
        type: number
        sql: original_price
      - name: attempts
        type: number
        sql: attempts
      - name: last_failed_at
        type: time
        sql: last_failed_at
      - name: next_retry_at
        type: time
        sql: next_retry_at
      - name: skipped_count
        type: number
        sql: skipped_count
      - name: max_skips
        type: number
        sql: max_skips
      - name: trial_ends_at
        type: time
        sql: trial_ends_at
      - name: cancelled_at
        type: time
        sql: cancelled_at
      - name: approve_count
        type: number
        sql: approve_count
      - name: decline_count
        type: number
        sql: decline_count
      - name: billing
        type: boolean
        sql: billing
      - name: order_item_id
        type: number
        sql: order_item_id

    measures:
      - name: count
        type: count
      - name: total_subscription_amount
        type: sum
        sql: price

    joins:
      - name: companies
        sql: "{CUBE}.company_id = {companies}.id"
        relationship: many_to_one
      - name: users
        sql: "{CUBE}.user_id = {users}.id"
        relationship: many_to_one
      - name: contacts
        sql: "{CUBE}.contact_id = {contacts}.id"
        relationship: many_to_one
      - name: subscription_plans
        sql: "{CUBE}.subscription_plan_id = {subscription_plans}.id"
        relationship: many_to_one
      - name: customers
        sql: "{CUBE}.customer_id = {customers}.id"
        relationship: many_to_one
