import{E as e,D as t}from"./p-B7Yk6rNY.js";import{G as a,k as l}from"./p-C4wedjxV.js";import{S as r}from"./p-BG3D11hv.js";import{W as n,F as s,c as o,w as i,a as u,Y as d,U as c,v as p,P as m,G as g,k as b,E as y,M as h}from"./p-CKrqpXF-.js";import{D as f}from"./p-BpMJ0iVV.js";import{c as v}from"./p-BvW5kj19.js";import{P as C}from"./p-D9lurr2W.js";import"./p-CBK12GNN.js";import"./p-DgA2OfDc.js";i.register(u,d,c,p,m,g,b,y,h);const w=e=>{const{results:t,maxSegments:a,metric:i,slice:u,onClick:d,granularity:c}=e,p=l(),m=f.useMemo((()=>{var e;let a;return(u==null?void 0:u.nativeType)==="time"&&c&&c in p.dateFormats&&(a=p.dateFormats[c]),((e=t==null?void 0:t.data)==null?void 0:e.map((e=>({...e,...(u==null?void 0:u.name)&&{[u.name]:a?v(e==null?void 0:e[u.name],{meta:u==null?void 0:u.meta,dateFormat:a}):e==null?void 0:e[u.name]}}))))??[]}),[t==null?void 0:t.data,u,c,p.dateFormats]);n(p,"pie");let g=p.charts.colors;p.charts.pie.colors&&(g=p.charts.pie.colors);const b={...e,theme:p,results:{...t,data:m}},[y,h]=f.useState(null),w=f.useRef(null),D=e=>{if(!e.length||e[0].index===y){d({slice:null,metric:null}),h(null);return}const{index:t}=e[0];a&&t+1>=a||(h(t),d({slice:m==null?void 0:m[t][u.name],metric:m==null?void 0:m[t][i.name]}))},P=e=>{const{current:t}=w;t&&D(o(t,e))};return r.jsx(C,{...e,className:"overflow-y-hidden",children:r.jsx(s,{height:"100%",options:k(b,p),data:j(b,g),ref:w,onClick:P})})};function k(e,t){return{responsive:true,maintainAspectRatio:false,animation:{duration:400,easing:"linear"},cutout:"45%",plugins:{datalabels:{backgroundColor:t.charts.pie.labels.backgroundColor,borderRadius:t.charts.pie.labels.borderRadius,color:t.charts.pie.labels.color,display:e.showLabels?"auto":false,font:{size:t.charts.pie.labels.font.size,weight:t.charts.pie.labels.font.weight},formatter:t=>{const a=t?v(t,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta}):null;return e.displayAsPercentage?`${a}%`:a}},tooltip:{callbacks:{label:function(t){let a=t.dataset.label||"";return typeof t.dataset.label=="boolean"&&(a=t.dataset.label?"True":"False"),t.parsed!==null&&(a+=`: ${v(`${t.parsed||""}`,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta})}`),a=e.displayAsPercentage?`${a}%`:a,a}}},legend:{display:e.showLegend,position:"bottom",labels:{usePointStyle:true,boxHeight:10}}}}}function D(e,t,a,l){if(!l||!a||!t)return e;const r=[...e||[]].sort(((e,t)=>parseInt(t[a.name])-parseInt(e[a.name]))).slice(0,l-1),n=e==null?void 0:e.slice(l-1).reduce(((e,t)=>e+parseInt(t[a.name])),0);return r.push({[t.name]:"Other",[a.name]:n}),r}function j(e,t){var a;const{maxSegments:l,results:r,metric:n,slice:s,displayAsPercentage:o,theme:i}=e,u=l&&l<(((a=r==null?void 0:r.data)==null?void 0:a.length)||0)?D(r.data||[],s,n,l):r.data,d=u==null?void 0:u.map((e=>e[s.name])),c=o?u==null?void 0:u.reduce(((e,t)=>e+parseFloat(t[n.name])),0):null,p=u==null?void 0:u.map((e=>{const t=parseFloat(e[n.name]);return o&&c?t*100/c:t}));return{labels:d,datasets:[{data:p,backgroundColor:t,borderColor:i.charts.pie.borderColor,borderWidth:i.charts.pie.borderWidth,weight:i.charts.pie.weight}]}}const P={name:"PieChart",label:"Pie chart",classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",category:"Chart data"},{name:"slice",type:"dimension",label:"Slice",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"metric",type:"measure",label:"Metric",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"showLegend",type:"boolean",label:"Turn on the legend",defaultValue:true,category:"Chart settings"},{name:"maxSegments",type:"number",label:"Max Legend items",defaultValue:8,category:"Chart settings"},{name:"showLabels",type:"boolean",label:"Show Labels",defaultValue:false,category:"Chart settings"},{name:"displayAsPercentage",type:"boolean",label:"Display as Percentages",defaultValue:false,category:"Chart settings"},{name:"dps",type:"number",label:"Decimal Places",category:"Formatting"},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true}],events:[{name:"onClick",label:"Click",properties:[{name:"slice",type:"string"},{name:"metric",type:"number"}]}]},V=a(w,P,{props:e=>{var a,l;return{...e,granularity:(l=(a=e.slice)==null?void 0:a.inputs)==null?void 0:l.granularity,results:t({from:e.ds,select:[e.slice,e.metric]})}},events:{onClick:t=>({slice:t.slice||e.noFilter(),metric:t.metric||e.noFilter()})}});export{V as default,P as meta};
//# sourceMappingURL=p-BrZ7bOKf.js.map