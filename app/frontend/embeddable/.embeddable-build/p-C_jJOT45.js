import{z as e,D as l}from"./p-DZclBDBz.js";import{G as n,k as t,H as o}from"./p-CptBl6Le.js";import{D as a,o as r}from"./p-DPnbBtDj.js";import{S as s}from"./p-D-ZJqqO3.js";import{D as i}from"./p-UGbmf8ph.js";import{P as d,G as c,O as u,V as m,k as p}from"./p-BDmepEmC.js";import{s as f}from"./p-B9_Pdnp6.js";import{c as b,d as h}from"./p-BvW5kj19.js";import"./p-CBK12GNN.js";import"./p-sWS4yEkp.js";const g=({currentPage:e,hasNextPage:l,onPageChange:n})=>s.jsxs("div",{className:`\n        flex\n        items-center\n        justify-center\n        left-0\n        select-none\n        sticky\n        font-[--embeddable-charts-fontWeights-pagination]\n        text-[color:--embeddable-font-colorNormal]\n        text-[size:--embeddable-font-size]\n      `,children:[s.jsx(m,{className:f(`\n            border\n            cursor-pointer\n            flex\n            h-8\n            hover:bg-black/10\n            items-center\n            justify-center\n            p-1\n            w-8\n            border-[color:--embeddable-controls-borders-colors-normal]\n            rounded-[--embeddable-controls-borders-radius]\n          `,{"opacity-50 pointer-events-none":e===0}),onClick:()=>{n==null||n(e-1)}}),s.jsxs("span",{className:"mx-4",children:["Page ",e+1]}),s.jsx(p,{className:f(`\n          border\n          cursor-pointer\n          flex\n          h-8\n          hover:bg-black/10\n          items-center\n          justify-center\n          p-1\n          w-8\n          border-[color:--embeddable-controls-borders-colors-normal]\n          rounded-[--embeddable-controls-borders-radius]\n          \n        `,{"opacity-50 pointer-events-none":!l}),onClick:()=>{n==null||n(e+1)}})]}),y=({columns:e,sortBy:l,sortDirection:n,onSortingChange:o,minColumnWidth:a})=>(t(),s.jsx("thead",{className:"border-y border-[color:--embeddable-controls-boders-colors-primary]",children:s.jsx("tr",{children:e==null?void 0:e.map((e=>{var t;const i=(l==null?void 0:l.name)===e.name,d=i?n===r.ASCENDING?r.DESCENDING:r.ASCENDING:r.ASCENDING;return s.jsx("th",{className:`\n                cursor-pointer\n                p-3\n                select-none\n                bg-[color:--embeddable-controls-backgrounds-colors-soft]\n              `,style:a?{minWidth:`${a}px`,maxWidth:`${a*1.2}px`}:{},onClick:()=>o==null?void 0:o(e,d),children:s.jsxs("div",{className:"flex items-center gap-1 hover:text-black",children:[s.jsx("span",{className:"embeddable-table-header mr-1 truncate",children:((t=e==null?void 0:e.inputs)==null?void 0:t.customColumnLabel)??e.title}),i?s.jsx("span",{className:"w-3",children:n===r.ASCENDING?s.jsx(c,{fill:"currentcolor"}):s.jsx(u,{fill:"currentcolor"})}):null]})},e.name)}))})})),v=l=>{var n,a,c,u,m,p,f,b;const{columns:h,results:v,allResults:x}=l,[N,w]=i.useState(false),[D,S]=i.useState(0),[j,k]=i.useState(false),[P,B]=i.useState(false),W=t(),[z,V]=o({downloadAll:false,maxRowsFit:0,page:0,prevVariableValues:{},sort:l.defaultSort});i.useEffect((()=>{j||V((e=>({...e,maxRowsFit:D})))}),[l.columns,D,V,j]),i.useEffect((()=>{if(N){if(!x||!x.data||x.data.length===0)return;e(l,x==null?void 0:x.data,[],"downloaded-chart-data"),w(false),V((e=>({...e,downloadAll:false})))}}),[x,N,l,V]);const A=i.useCallback((({height:e})=>{var n,t;let o=0;const a=(e||76)-76,r=Math.floor(a/44);D===r&&r===o||((t=(n=l.results)==null?void 0:n.data)==null?void 0:t.length)===0||S(o=r)}),[D,l.results]),R=i.useCallback((()=>{V((e=>({...e,downloadAll:true}))),w(true)}),[V]),M=i.useCallback((e=>{var l;if(!z)return;const n=((l=z.sort)==null?void 0:l.slice())||[],t={asc:"desc",desc:"asc"},o=n.findIndex((l=>l.property.name===e.name));if(o===0)n[0]={...n[0],direction:t[n[0].direction]};else{const[e]=n.splice(o,1);n.unshift(e)}V((e=>({...e,sort:n,page:0})))}),[z,V]);return i.useEffect((()=>{var e,n;(n=(e=l.results)==null?void 0:e.data)!=null&&n.length&&B(l.limit?l.results.data.length>=l.limit:false)}),[l.results,l.limit]),s.jsxs(d,{...l,childContainerClassName:"overflow-x-auto",className:"overflow-y-auto",downloadAllFunction:R,onResize:A,setResizeState:e=>k(e),children:[s.jsx("div",{style:{minWidth:`${(h==null?void 0:h.length)*(l.minColumnWidth??100)}px`},children:!!z&&!((n=l.results)!=null&&n.isLoading&&!((c=(a=l.results)==null?void 0:a.data)!=null&&c.length))&&s.jsxs("table",{className:"overflow-visible w-full",style:{fontSize:l.fontSize?`${l.fontSize}px`:W.font.size},children:[s.jsx(y,{columns:h,sortBy:(m=(u=z==null?void 0:z.sort)==null?void 0:u[0])==null?void 0:m.property,sortDirection:((f=(p=z==null?void 0:z.sort)==null?void 0:p[0])==null?void 0:f.direction)==="asc"?r.ASCENDING:r.DESCENDING,onSortingChange:M,minColumnWidth:l.minColumnWidth?l.minColumnWidth:void 0}),s.jsx("tbody",{children:(b=v==null?void 0:v.data)==null?void 0:b.slice(0,D).map(((e,n)=>s.jsx("tr",{className:"hover:bg-gray-400/5",children:h.map(((n,t)=>{const o=C(e[n.name],n);let a="";return typeof o=="object"?a=o.props.children:a=o,s.jsx("td",{className:"text-dark p-3 truncate",style:{fontSize:l.fontSize?`${l.fontSize}px`:W.font.size,maxWidth:l.minColumnWidth?`${l.minColumnWidth*1.2}px`:"auto"},children:s.jsx("span",{title:a,children:o})},t)}))},n)))})]})}),s.jsx(g,{currentPage:(z==null?void 0:z.page)||0,hasNextPage:P,onPageChange:e=>{V((l=>({...l,page:e})))}})]})};function C(e,l){if(e==null)return"-";if(typeof e=="number"||l.nativeType==="number")return b(`${e}`,{type:"number",meta:l==null?void 0:l.meta});if(typeof e=="boolean")return e?"True":"False";if(e&&l.nativeType==="time")return b(e,"date");const{linkText:n,linkUrl:t}=h(e);return n&&t?s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:n}):b(e)}const x={name:"TableChart",label:"Table",defaultHeight:300,defaultWidth:900,classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",description:"Dataset",defaultValue:false,category:"Chart data"},{name:"columns",type:"dimensionOrMeasure",label:"Columns",array:true,required:true,config:{dataset:"ds"},category:"Chart data",inputs:[{name:"customColumnLabel",type:"string",label:"Column Header",description:"Custom label to display instead of the default column header"}]},{name:"title",type:"string",label:"Title",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"maxPageRows",type:"number",label:"Max Page Rows",category:"Chart settings"},{name:"defaultSort",type:"dimensionOrMeasure",config:{dataset:"ds"},label:"Default Sort",category:"Chart settings"},{name:"defaultSortDirection",type:a,defaultValue:"Ascending",label:"Default Sort Direction",category:"Chart settings"},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true},{name:"minColumnWidth",type:"number",label:"Minimum column width in pixels",defaultValue:150,category:"Chart styling"},{name:"fontSize",type:"number",label:"Font size in pixels",category:"Chart styling"}]},N=n(v,x,{props:(e,[n])=>{var t,o;const a=((t=e==null?void 0:e.ds)==null?void 0:t.variableValues)||{},r=(n==null?void 0:n.prevVariableValues)||{},s=e.maxPageRows||n!=null&&n.maxRowsFit?Math.min(e.maxPageRows||1e3,Math.max(n==null?void 0:n.maxRowsFit,1)||1e3):0,i=e.defaultSortDirection==="Ascending"?"asc":"desc",d=((o=e.columns)==null?void 0:o.filter((l=>{var n;return l.name!==((n=e.defaultSort)==null?void 0:n.name)})).map((e=>({property:e,direction:i}))))||[];e.defaultSort&&d.unshift({property:e.defaultSort,direction:i}),n&&JSON.stringify(a)!==JSON.stringify(r)&&(n.prevVariableValues=a,n.page=0);const c=s<1?{isLoading:true}:l({from:e.ds,select:e.columns,limit:s,offset:s*((n==null?void 0:n.page)||0),orderBy:(n==null?void 0:n.sort)||d}),u=l({from:e.ds,select:e.columns,limit:n!=null&&n.downloadAll?1e4:0,offset:0,orderBy:(n==null?void 0:n.sort)||d});return{...e,limit:s,defaultSort:d,results:c,allResults:u}}});export{N as default,x as meta};
//# sourceMappingURL=p-C_jJOT45.js.map