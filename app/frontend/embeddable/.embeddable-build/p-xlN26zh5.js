import{E as e,D as t}from"./p-DbsLTMHQ.js";import{G as a,k as l}from"./p-C7Q3h1tE.js";import{S as r}from"./p-fERGjQ4F.js";import{W as n,F as s,b as o,w as i,a as u,Y as d,U as c,v as p,P as m,G as g,k as b,E as y,M as h}from"./p-9nlLijaU.js";import{D as f}from"./p-D-AfQOnq.js";import{c as v}from"./p-BvW5kj19.js";import{P as C}from"./p-QU8eYX34.js";import"./p-CBK12GNN.js";import"./p-BEjya3u4.js";i.register(u,d,c,p,m,g,b,y,h);const j=e=>{const{results:t,title:a,maxSegments:i,metric:u,slice:d,onClick:c,granularity:p}=e,m=l(),g=f.useMemo((()=>{var e;let a;return(d==null?void 0:d.nativeType)==="time"&&p&&p in m.dateFormats&&(a=m.dateFormats[p]),((e=t==null?void 0:t.data)==null?void 0:e.map((e=>({...e,...(d==null?void 0:d.name)&&{[d.name]:a?v(e==null?void 0:e[d.name],{meta:d==null?void 0:d.meta,dateFormat:a}):e==null?void 0:e[d.name]}}))))??[]}),[t==null?void 0:t.data,d,p,m.dateFormats]);n(m,"pie");let b=m.charts.colors;m.charts.pie.colors&&(b=m.charts.pie.colors);const y={...e,theme:m,results:{...t,data:g}},[h,j]=f.useState(null),P=f.useRef(null),D=e=>{if(!e.length||e[0].index===h){c({slice:null,metric:null}),j(null);return}const{index:t}=e[0];i&&t+1>=i||(j(t),c({slice:g==null?void 0:g[t][d.name],metric:g==null?void 0:g[t][u.name]}))},S=e=>{const{current:t}=P;t&&D(o(t,e))};return r.jsx(C,{...e,className:"overflow-y-hidden",children:r.jsx(s,{"aria-label":a?`Pie Chart: ${a}`:"Pie Chart","aria-roledescription":"pie chart",height:"100%",options:w(y,m),data:k(y,b),ref:P,onClick:S})})};function w(e,t){return{responsive:true,maintainAspectRatio:false,animation:{duration:400,easing:"linear"},cutout:"45%",plugins:{datalabels:{backgroundColor:t.charts.pie.labels.backgroundColor,borderRadius:t.charts.pie.labels.borderRadius,color:t.charts.pie.labels.color,display:e.showLabels?"auto":false,font:{size:t.charts.pie.labels.font.size,weight:t.charts.pie.labels.font.weight},formatter:t=>{const a=t?v(t,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta}):null;return e.displayAsPercentage?`${a}%`:a}},tooltip:{callbacks:{label:function(t){let a=t.dataset.label||"";return typeof t.dataset.label=="boolean"&&(a=t.dataset.label?"True":"False"),t.parsed!==null&&(a+=`: ${v(`${t.parsed||""}`,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta})}`),a=e.displayAsPercentage?`${a}%`:a,a}}},legend:{display:e.showLegend,position:"bottom",labels:{usePointStyle:true,boxHeight:10}}}}}function P(e,t,a,l){if(!l||!a||!t)return e;const r=[...e||[]].sort(((e,t)=>parseInt(t[a.name])-parseInt(e[a.name]))).slice(0,l-1),n=e==null?void 0:e.slice(l-1).reduce(((e,t)=>e+parseInt(t[a.name])),0);return r.push({[t.name]:"Other",[a.name]:n}),r}function k(e,t){var a;const{maxSegments:l,results:r,metric:n,slice:s,displayAsPercentage:o,theme:i}=e,u=l&&l<(((a=r==null?void 0:r.data)==null?void 0:a.length)||0)?P(r.data||[],s,n,l):r.data,d=u==null?void 0:u.map((e=>e[s.name])),c=o?u==null?void 0:u.reduce(((e,t)=>e+parseFloat(t[n.name])),0):null,p=u==null?void 0:u.map((e=>{const t=parseFloat(e[n.name]);return o&&c?t*100/c:t}));return{labels:d,datasets:[{data:p,backgroundColor:t,borderColor:i.charts.pie.borderColor,borderWidth:i.charts.pie.borderWidth,weight:i.charts.pie.weight}]}}const D={name:"PieChart",label:"Pie chart",classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",category:"Chart data"},{name:"slice",type:"dimension",label:"Slice",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"metric",type:"measure",label:"Metric",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"showLegend",type:"boolean",label:"Turn on the legend",defaultValue:true,category:"Chart settings"},{name:"maxSegments",type:"number",label:"Max Legend items",defaultValue:8,category:"Chart settings"},{name:"showLabels",type:"boolean",label:"Show Labels",defaultValue:false,category:"Chart settings"},{name:"displayAsPercentage",type:"boolean",label:"Display as Percentages",defaultValue:false,category:"Chart settings"},{name:"dps",type:"number",label:"Decimal Places",category:"Formatting"},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true}],events:[{name:"onClick",label:"Click",properties:[{name:"slice",type:"string"},{name:"metric",type:"number"}]}]},S=a(j,D,{props:e=>{var a,l;return{...e,granularity:(l=(a=e.slice)==null?void 0:a.inputs)==null?void 0:l.granularity,results:t({from:e.ds,select:[e.slice,e.metric]})}},events:{onClick:t=>({slice:t.slice||e.noFilter(),metric:t.metric||e.noFilter()})}});export{S as default,D as meta};
//# sourceMappingURL=p-xlN26zh5.js.map