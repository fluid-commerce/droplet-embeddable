import{D as e}from"./p-B7Yk6rNY.js";import{G as t,k as a}from"./p-C4wedjxV.js";import{S as i}from"./p-BG3D11hv.js";import{W as r,B as o,I as l,w as s,Y as n,U as p,v as d,P as m,k as u,E as c,M as y,m as g,a as b}from"./p-CKrqpXF-.js";import"./p-BwPuT_aN.js";import{D as f}from"./p-BpMJ0iVV.js";import{R as v}from"./p-DNmQi9H5.js";import{n as h,s as x,c as C}from"./p-BvW5kj19.js";import{m as D}from"./p-e2Wdry-T.js";import{r as A}from"./p-BIFnrNPV.js";import{P as j}from"./p-D9lurr2W.js";import"./p-DUIxdZrE.js";import"./p-BcYWNS4N.js";import"./p-CBK12GNN.js";import"./p-DgA2OfDc.js";s.register(n,p,d,m,u,c,y,g,b);const V=e=>{const t=a(),s=f.useMemo((()=>({...e,theme:t,granularity:e.granularity||"day"})),[e,t]);r(t,"line");const{fillGaps:n}=v(s,"desc"),p=f.useMemo((()=>{var e,a;const{results:i,prevResults:r,metrics:o,applyFill:l}=s,p=(e=i==null?void 0:i.data)==null?void 0:e.reduce(n,[]),d=(a=r==null?void 0:r.data)==null?void 0:a.reduce(n,[]),m=(o==null?void 0:o.map(((e,a)=>({xAxisID:"period",label:e.title,data:(p==null?void 0:p.map((t=>{var a;return{y:parseFloat(t[e.name]||"0"),x:h(t[((a=s.xAxis)==null?void 0:a.name)||""])}})))||[],backgroundColor:l?A(t.charts.colors[a%t.charts.colors.length],.2):t.charts.colors[a%t.charts.colors.length],borderColor:t.charts.colors[a%t.charts.colors.length],pointRadius:0,tension:t.charts.line.lineTension,pointHoverRadius:3,fill:l,cubicInterpolationMode:t.charts.line.cubicInterpolationMode}))))||[];return{datasets:[...m,...m.map(((e,a)=>{const i=A(t.charts.colors[a%t.charts.colors.length],.5);return{cubicInterpolationMode:t.charts.bar.cubicInterpolationMode,showLine:!!s.prevTimeFilter,xAxisID:"comparison",label:`Previous ${o[a].title}`,data:s.prevTimeFilter?(d==null?void 0:d.map((e=>{var t;return{y:parseFloat(e[o[a].name]||"0"),x:h(e[((t=s.comparisonXAxis)==null?void 0:t.name)||s.xAxis.name||""])}})))||[]:[],backgroundColor:l?A(t.charts.colors[a%t.charts.colors.length],.05):i,borderColor:i,pointRadius:0,tension:t.charts.line.lineTension,pointHoverRadius:3,fill:l&&!!s.prevTimeFilter,segment:{borderDash:[10,5]}}}))]}}),[s,n,t]),d=f.useMemo((()=>{var e,a,i,r,l,n,p,d;const m={period:x(s.timeFilter),comparison:x(s.prevTimeFilter)};return{responsive:true,maintainAspectRatio:false,interaction:{mode:"index",intersect:false},layout:{padding:{left:0,right:0,top:s.showLabels?20:0,bottom:0}},scales:{y:{min:s.yAxisMin,grace:"0%",grid:{display:false},title:{display:!!s.yAxisTitle,text:s.yAxisTitle},callback:function(e){return C(e.toString(),{type:"number"})},afterDataLimits:function(e){o(e,s.results,[...s.metrics],s.dps)}},period:{min:(a=(e=m.period)==null?void 0:e.from)==null?void 0:a.toJSON(),max:(r=(i=m.period)==null?void 0:i.to)==null?void 0:r.toJSON(),grid:{display:false},type:"time",time:{round:s.granularity,isoWeekday:true,displayFormats:t.dateFormats,unit:s.granularity},title:{display:!!s.xAxisTitle,text:s.xAxisTitle}},comparison:{min:(n=(l=m.comparison)==null?void 0:l.from)==null?void 0:n.toJSON(),max:(d=(p=m.comparison)==null?void 0:p.to)==null?void 0:d.toJSON(),display:!!s.comparisonXAxis,grid:{display:false},type:"time",time:{round:s.granularity,isoWeekday:true,displayFormats:t.dateFormats,unit:s.granularity},title:{display:!!s.comparisonXAxisTitle,text:s.comparisonXAxisTitle}}},animation:{duration:400,easing:"linear"},plugins:{legend:{display:s.showLegend,position:"bottom",labels:{usePointStyle:true,boxHeight:8}},tooltip:{callbacks:{title:e=>D(e,s.granularity,t),label:function(e){const t=e.datasetIndex%s.metrics.length,a=s.metrics[t];let i=e.dataset.label||"";return e.parsed.y!==null&&(i+=`: ${C(`${e.parsed.y}`,{type:"number",dps:s.dps,meta:a==null?void 0:a.meta})}`),i}}},datalabels:{align:"top",display:s.showLabels?"auto":false,backgroundColor:t.charts.line.labels.backgroundColor,borderRadius:t.charts.line.labels.borderRadius,color:t.charts.line.labels.color,font:{size:t.charts.line.labels.font.size,weight:t.charts.line.labels.font.weight},formatter:(e,t)=>{const a=t.datasetIndex%s.metrics.length,i=s.metrics[a];return e?C(e.y,{type:"number",dps:s.dps,meta:i==null?void 0:i.meta}):null}}}}}),[s]);return i.jsx(j,{...s,className:"overflow-y-hidden",children:i.jsx(l,{height:"100%",options:d,data:p})})},w={name:"CompareLineChart",label:"Line comparison (time-series)",classNames:["inside-card"],category:"Charts: time-series comparison",inputs:[{name:"ds",type:"dataset",label:"Dataset",description:"Dataset",defaultValue:false,category:"Chart data"},{name:"xAxis",type:"dimension",label:"X-Axis",config:{dataset:"ds",supportedTypes:["time"],hideGranularity:true},category:"Chart data"},{name:"comparisonXAxis",type:"dimension",label:"Comparison X-Axis (optional)",config:{dataset:"ds",supportedTypes:["time"],hideGranularity:true},category:"Chart data"},{name:"metrics",type:"measure",array:true,label:"Metrics",config:{dataset:"ds"},category:"Chart data"},{name:"granularity",type:"granularity",label:"Granularity",defaultValue:"day",category:"Variables to configure"},{name:"timeFilter",type:"timeRange",label:"Primary date range",description:"Date range",category:"Variables to configure"},{name:"prevTimeFilter",type:"timeRange",label:"Comparison date range",description:"Date range",category:"Variables to configure"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"xAxisTitle",type:"string",label:"X-Axis Title",category:"Chart settings"},{name:"comparisonXAxisTitle",type:"string",label:"Comparison X-Axis Title (optional)",description:"Title for the comparison X-Axis",category:"Chart settings",defaultValue:""},{name:"yAxisTitle",type:"string",label:"Y-Axis Title",category:"Chart settings"},{name:"showLabels",type:"boolean",label:"Show Labels",category:"Chart settings",defaultValue:false},{name:"applyFill",type:"boolean",label:"Color fill space under line",category:"Chart settings",defaultValue:false},{name:"yAxisMin",type:"number",label:"Y-Axis minimum value",category:"Chart settings"},{name:"showLegend",type:"boolean",label:"Show Legend",category:"Chart settings",defaultValue:true},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true},{name:"dps",type:"number",label:"Decimal Places",category:"Formatting"}]},T=t(V,w,{props:t=>{var a,i;const r=[];return r.push({property:t.xAxis,direction:"desc"}),{...t,results:e({from:t.ds,limit:500,orderBy:r,select:[{dimension:(a=t.xAxis)==null?void 0:a.name,granularity:t.granularity},t.metrics],filters:t.timeFilter&&t.xAxis?[{property:t.xAxis,operator:"inDateRange",value:t.timeFilter}]:void 0}),prevResults:e({from:t.ds,select:[{dimension:(i=t.xAxis)==null?void 0:i.name,granularity:t.granularity},t.metrics],limit:t.prevTimeFilter?500:1,orderBy:r,filters:t.prevTimeFilter&&t.xAxis?[{property:t.xAxis,operator:"inDateRange",value:{from:t.prevTimeFilter.from,relativeTimeString:"",to:t.prevTimeFilter.to}}]:void 0})}}});export{T as default,w as meta};
//# sourceMappingURL=p-ga3xa-hM.js.map