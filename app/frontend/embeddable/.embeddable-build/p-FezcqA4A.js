import{E as e,w as o,S as n,D as r}from"./p-B7Yk6rNY.js";import{G as l,H as t}from"./p-C4wedjxV.js";import{S as a}from"./p-BG3D11hv.js";import{D as s}from"./p-BpMJ0iVV.js";import{h as i,r as d}from"./p-JmBl84Vv.js";import{P as c,R as u,T as p}from"./p-D9lurr2W.js";import"./p-CBK12GNN.js";import"./p-DgA2OfDc.js";let m;const b=e=>{const r=s.useRef(null),[l,b]=s.useState(false),[f,v]=s.useState(false),[g,h]=s.useState(""),[y,w]=s.useState(false),[x,D]=s.useState(e.defaultValue),[N,k]=t({[e.searchProperty||"search"]:""});s.useEffect((()=>{D(e.defaultValue)}),[e.defaultValue]),s.useEffect((()=>{let e=null;return f?e&&clearTimeout(e):e=setTimeout((()=>{b(false)}),200),()=>{e&&clearTimeout(e)}}),[f]),s.useLayoutEffect((()=>{if(!y)return;const e=setTimeout((()=>{b(false),w(false)}),500);return()=>clearTimeout(e)}),[y]);const B=s.useCallback((o=>{h(o),clearTimeout(m),m=window.setTimeout((()=>{k((n=>({...n,[e.searchProperty||"search"]:o})))}),500)}),[h,k,e.searchProperty]),C=s.useCallback((o=>{B("");let n=[];o!==""&&(n=x||[],n!=null&&n.includes(o)?n=n.filter((e=>e!==o)):n=[...n,o]),e.onChange(n),D(n),k((o=>({...o,[e.searchProperty||"search"]:""}))),clearTimeout(m)}),[B,e,x]),S=(e,o,n)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),o(e)),e.key==="Escape"&&(e.preventDefault(),b(false),w(true))},V=s.useMemo((()=>{var o,n;return(n=(o=e.options)==null?void 0:o.data)==null?void 0:n.reduce(((o,n,r)=>{var l,t,s;return o.push(a.jsxs("div",{onClick:()=>{var o;b(true),C(n[((o=e.property)==null?void 0:o.name)||""]||"")},onKeyDown:o=>S(o,(()=>{var o;return C(n[((o=e.property)==null?void 0:o.name)||""]||"")})),onFocus:()=>{v(true),b(true)},className:`flex items-center min-h-[36px] w-full px-3 py-2 hover:bg-black/5 cursor-pointer font-normal gap-1 ${x!=null&&x.includes(n[((l=e.property)==null?void 0:l.name)||""])?"bg-black/5":""}`,tabIndex:0,children:[x!=null&&x.includes(n[((t=e.property)==null?void 0:t.name)||""])?a.jsx("div",{className:"w-[16px] h-[16px] inline-block",children:a.jsx(i,{})}):a.jsx("div",{className:"w-[16px] h-[16px] inline-block",children:a.jsx(d,{})}),a.jsxs("div",{className:"block w-full truncate",children:[n[((s=e.property)==null?void 0:s.name)||""],n.note&&a.jsx("span",{className:"font-normal ml-auto pl-3 text-xs opacity-70",children:n.note})]})]},r)),o}),[])}),[e,x,C]);return a.jsx(c,{title:e.title,children:a.jsxs("div",{className:o(`\n            border\n            flex\n            h-10\n            items-center\n            min-w-[50px]\n            relative\n            w-full\n            bg-[color:--embeddable-controls-backgrounds-colors-soft]\n            border-[color:--embeddable-controls-borders-colors-normal]\n            rounded-[--embeddable-controls-borders-radius]\n            `,e.className),children:[a.jsx("input",{ref:r,value:g,name:"dropdown",placeholder:e.placeholder,onClick:()=>{b(true),w(false)},onFocus:()=>{b(true),w(false),v(true)},onBlur:()=>{v(false)},onChange:e=>B(e.target.value),className:`\n            border-0\n            cursor-pointer\n            h-9\n            leading-9\n            outline-none\n            px-3\n            text-sm ${l||!x?"":"opacity-0"}\n            w-full\n            rounded-[--embeddable-controls-borders-radius]\n            bg-[color:--embeddable-controls-backgrounds-colors-transparent]\n          `}),!!x&&a.jsxs("span",{className:`\n              absolute\n              block\n              h-8\n              leading-8\n              left-3\n              overflow-hidden\n              pointer-events-none\n              text-sm\n              top-1\n              truncate\n              w-[calc(100%-2rem)]\n              whitespace-nowrap\n              bg-[color:--embeddable-controls-backgrounds-colors-soft]\n              border-[color:--embeddable-controls-borders-colors-normal]\n              rounded-[--embeddable-controls-borders-radius]\n              ${l?"hidden":""}\n            `,children:["Selected ",x.length," ",x.length===1?"option":"options"]}),l&&a.jsxs("div",{style:{minWidth:e.minDropdownWidth},className:`\n              absolute\n              border\n              flex\n              flex-col\n              max-h-[400px]\n              overflow-x-hidden\n              overflow-y-auto\n              top-11\n              w-full\n              z-50\n              bg-[color:--embeddable-controls-backgrounds-colors-soft]\n              rounded-[--embeddable-controls-borders-radius]\n            `,onFocus:()=>{v(true)},onBlur:()=>{v(false)},tabIndex:0,children:[V,(V==null?void 0:V.length)===0&&!!g&&a.jsx("div",{className:"px-3 py-2 text-black/50 italic cursor-pointer",children:"No results"})]}),e.options.isLoading?a.jsx(n,{show:true,className:"absolute right-2 top-2 z-1 pointer-events-none"}):a.jsx(u,{className:"absolute right-2.5 top-2.5 z-1 pointer-events-none"}),!e.unclearable&&!!x&&a.jsx("div",{onClick:()=>{C("")},className:"absolute right-10 top-0 h-10 flex items-center z-10 cursor-pointer",children:a.jsx(p,{})})]})})},f={name:"MultiSelectDropdown",label:"Multi-Select dropdown",defaultWidth:300,defaultHeight:80,classNames:["on-top"],category:"Controls: inputs & dropdowns",inputs:[{name:"ds",type:"dataset",label:"Dataset",description:"Dataset",category:"Dropdown values"},{name:"property",type:"dimension",label:"Property",config:{dataset:"ds"},category:"Dropdown values"},{name:"sortBy",type:"dimensionOrMeasure",label:"Optional Sort By Additional Dimension or Measure",config:{dataset:"ds"},category:"Dropdown values"},{name:"sortByDirection",type:"string",label:"Sort By Direction (asc/desc)",defaultValue:"asc",category:"Dropdown values"},{name:"title",type:"string",label:"Title",category:"Settings"},{name:"defaultValue",type:"string",array:true,label:"Default value",category:"Pre-configured variables"},{name:"placeholder",type:"string",label:"Placeholder",defaultValue:"Select...",category:"Settings"},{name:"limit",type:"number",label:"Default number of options",defaultValue:100,category:"Settings"}],events:[{name:"onChange",label:"Change",properties:[{name:"value",type:"string",array:true}]}],variables:[{name:"dropdown choices",type:"string",defaultValue:e.noFilter(),array:true,inputs:["defaultValue"],events:[{name:"onChange",property:"value"}]}]},v=l(b,f,{props:(e,[o])=>{if(!e.ds)return{...e,options:[]};const n=[];let l="asc";(e.sortByDirection==="desc"||e.sortByDirection==="asc")&&(l=e.sortByDirection);const t=l;e.sortBy&&n.push({property:e.sortBy,direction:t});const a=e.property?[e.property]:[];return e.sortBy&&e.sortBy!==e.property&&a.push(e.sortBy),{...e,options:r({from:e.ds,select:a,limit:e.limit||1e3,orderBy:n,filters:o!=null&&o.search&&e.property?[{operator:"contains",property:e.property,value:o==null?void 0:o.search}]:void 0})}},events:{onChange:o=>({value:o.length?o:e.noFilter()})}});export{v as default,f as meta};
//# sourceMappingURL=p-FezcqA4A.js.map