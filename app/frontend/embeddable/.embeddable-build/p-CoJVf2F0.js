import{d as e,c as t,D as n}from"./p-DbsLTMHQ.js";import{G as r,k as i}from"./p-C7Q3h1tE.js";import{o as a,D as o}from"./p-DGUxugmn.js";import{S as s}from"./p-fERGjQ4F.js";import{P as l,G as u,O as c,R as d}from"./p-QU8eYX34.js";import{D as h}from"./p-D-AfQOnq.js";import{s as m}from"./p-BgqM5XrE.js";import{c as p}from"./p-BvW5kj19.js";import"./p-BEjya3u4.js";import"./p-CBK12GNN.js";var f=Object.defineProperty,y=e=>{throw TypeError(e)},g=(e,t,n)=>t in e?f(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n,b=(e,t,n)=>g(e,typeof t!="symbol"?t+"":t,n),w=(e,t,n)=>t.has(e)||y("Cannot "+n),v=(e,t,n)=>(w(e,t,"read from private field"),n?n.call(e):t.get(e)),C=(e,t,n)=>t.has(e)?y("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,r)=>(w(e,t,"write to private field"),t.set(e,n),n),k=(e=>(e.NUMERIC_VALUES_ONLY="Numeric Value Only",e.VALUE_BARS="Value Bars",e.HEATMAP="Heat Map",e))(k||{}),S=(e=>(e.DIMENSION="dimension",e.MEASURE="measure",e.ROW_HEADER_GROUP="row-header-group",e.ROW_HEADER="row-header",e))(S||{});function W({columns:e,fontSize:t="16px",minColumnWidth:n,minHeaderColumnWidth:r,enableSorting:o=true,sortCriteria:l,onSortingChange:d}){const h=i();t=h.font.size;const p=(e,i)=>{var h,p,f,y,g,b;const w=e.type===S.ROW_HEADER||e.type===S.ROW_HEADER_GROUP,v=e.type!==S.DIMENSION||((h=e.children)==null?void 0:h.filter((e=>e.type===S.MEASURE)).length)===1,C=e.getLeafColumns(),D=w||C.some((e=>e.type===S.ROW_HEADER||e.type===S.ROW_HEADER_GROUP)),k=e.depth===0||e.type!==S.MEASURE||((y=(f=(p=e.parent)==null?void 0:p.children)==null?void 0:f.at(-1))==null?void 0:y.key)===e.key,W=o&&e.type!==S.DIMENSION,x=(g=l==null?void 0:l.find((t=>t.key===e.key)))==null?void 0:g.direction;return s.jsx("th",{colSpan:C.length,className:m("p-2 border-y first:border-l",{"border-b-0":(b=e.children)==null?void 0:b.length,"border-r":k,"lg:sticky lg:left-0 lg:z-10 bg-[color:--embeddable-controls-backgrounds-colors-soft]":D,"cursor-pointer":W}),style:n?{minWidth:(w?r:n)??"auto"}:{},...W?{onClick:()=>{d==null||d(e.key,x===a.DESCENDING?a.ASCENDING:a.DESCENDING)}}:null,children:s.jsxs("div",{className:m("text-center",{"text-left":v,"flex justify-between items-center gap-2":W}),children:[s.jsx("span",{className:"text-[color:--embeddable-font-colorNormal}]",style:{fontSize:t},children:e.label}),W?s.jsx("span",{className:m("w-3",{invisible:!x}),children:x===a.ASCENDING?s.jsx(u,{fill:"currentcolor"}):s.jsx(c,{fill:"currentcolor"})}):null]})},`${i}-${e.key}`)};return e.length?s.jsxs(s.Fragment,{children:[s.jsx("tr",{children:e.map(p)}),e[0].children?s.jsx(W,{columns:e.map((e=>(e==null?void 0:e.children)||[])).flat(),onSortingChange:d,fontSize:t,minColumnWidth:n,minHeaderColumnWidth:r,enableSorting:o,sortCriteria:l}):null]}):null}function x({isHeader:e,className:t,children:n}){const r=e?"th":"td";return s.jsx(r,{className:m("px-2 py-1.5 font-normal first:border-l bg-inherit",{"lg:z-10 lg:sticky lg:left-0 text-left":e},t),children:n})}const M=({columns:e,row:t,renderCell:n,level:r=0,isRowGroupDefaultExpanded:i})=>{var a;const[o,l]=h.useState(i??true),u=()=>{l((e=>!e))},c=(e,i)=>{var a,l,c,h;const p=e.type===S.ROW_HEADER;return s.jsx(x,{isHeader:p,className:m("border-b",{"border-r":!e.parent||((c=(l=(a=e.parent)==null?void 0:a.children)==null?void 0:l.at(-1))==null?void 0:c.key)===e.key||p}),children:s.jsxs("div",{className:"flex items-center",style:{marginLeft:p?`${r*30}px`:0},children:[(h=t.children)!=null&&h.length&&p?s.jsx(d,{className:m("w-4 h-4 mr-1 cursor-pointer transform",{"-rotate-90":!o}),onClick:u}):null,(n==null?void 0:n(i,e))||i[e.key]]})},`${t.id}-${e.key}`)},p=(e,t)=>e.map((e=>{var n;return e.type===S.ROW_HEADER_GROUP&&(n=e.group)!=null&&n.length?c(e.group[r],t):c(e,t)}));return s.jsxs(s.Fragment,{children:[s.jsx("tr",{className:`\n        bg-[color:--embeddable-controls-backgrounds-colors-soft]\n        hover:bg-[color:--embeddable-controls-backgrounds-colors-normal]`,children:p(e,t.data)}),o&&((a=t.children)==null?void 0:a.map((t=>s.jsx(M,{columns:e,row:t,renderCell:n,level:r+1},t.id))))]})},N="--\x3e",V=e=>e==null?"":e.toString().replaceAll(" ","_").toLowerCase(),R=e=>[...e.map((e=>V(e)))].join(N),j=[];for(let e=0;e<256;++e)j.push((e+256).toString(16).slice(1));function z(e,t=0){return(j[e[t+0]]+j[e[t+1]]+j[e[t+2]]+j[e[t+3]]+"-"+j[e[t+4]]+j[e[t+5]]+"-"+j[e[t+6]]+j[e[t+7]]+"-"+j[e[t+8]]+j[e[t+9]]+"-"+j[e[t+10]]+j[e[t+11]]+j[e[t+12]]+j[e[t+13]]+j[e[t+14]]+j[e[t+15]]).toLowerCase()}let E;const T=new Uint8Array(16);function G(){if(!E){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");E=crypto.getRandomValues.bind(crypto)}return E(T)}const $=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),L={randomUUID:$};function H(e,t,n){var r;if(L.randomUUID&&!e)return L.randomUUID();e=e||{};const i=e.random??((r=e.rng)==null?void 0:r.call(e))??G();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,z(i)}var B,F,Q,U;class _{constructor(e,t=[],n=0){C(this,B),C(this,F),C(this,Q),C(this,U),D(this,B,H()),D(this,F,e),D(this,Q,t),D(this,U,n)}get id(){return v(this,B)}get data(){return v(this,F)}set data(e){D(this,F,e)}get children(){return v(this,Q)}set children(e){D(this,Q,e)}get depth(){return v(this,U)}getLeafRows(){return this.children.length?this.children.reduce(((e,t)=>[...e,...t.getLeafRows()]),[]):[this]}}B=new WeakMap,F=new WeakMap,Q=new WeakMap,U=new WeakMap;var A,I,O,P,q,X,K,Y,J,Z,ee,te;class ne{constructor(e,t,n=[],r=[],i=true){C(this,A),C(this,I),C(this,O),C(this,P),C(this,q),C(this,X),C(this,K),C(this,Y,{}),C(this,J,((e,t)=>t==null?void 0:t.map((t=>(v(this,Y)[t.name]||(v(this,Y)[t.name]=new Set),v(this,Y)[t.name].add(e[t.name]),e[t.name]))))),C(this,Z,(e=>v(this,I).reduce(((t,n)=>({...t,[R([...v(this,J).call(this,e,v(this,P)),n.name])]:e[n.name]})),{}))),C(this,ee,((e,t,n)=>{if(!t.length){e.data={...e.data,...n};return}const r=V(t[0]);e.children.has(r)||e.children.set(r,{data:{},children:new Map}),v(this,ee).call(this,e.children.get(r),t.slice(1),n)})),C(this,te,((e,t=0)=>{const n=[];if(v(this,O).length)for(const[,r]of e.children)n.push(new _(r.data,v(this,te).call(this,r,t+1),t));else n.push(new _(e.data));return n})),D(this,A,e),D(this,I,t),D(this,O,n||[]),D(this,P,r),D(this,X,i),D(this,q,v(this,A).reduce(((e,t,n)=>{const r=v(this,X)?v(this,O).slice(0,n+1):v(this,O);return t.forEach((t=>{const n=v(this,J).call(this,t,r),i={...v(this,Z).call(this,t),...r.reduce(((e,n)=>({...e,[n.name]:t[n.name]})),{})};r.length&&v(this,O).length>1&&(i["__group.key"]=t[r.at(-1).name]),v(this,ee).call(this,e,n,i)})),e}),{data:{},children:new Map})),!v(this,O).length&&v(this,P).length&&v(this,A).forEach((e=>{e.forEach((e=>v(this,J).call(this,e,v(this,P))))})),D(this,K,null)}get rows(){return v(this,K)||D(this,K,v(this,te).call(this,v(this,q))),v(this,K)}getColumnDimensionValues(e){return[...v(this,Y)[e]]}}A=new WeakMap,I=new WeakMap,O=new WeakMap,P=new WeakMap,q=new WeakMap,X=new WeakMap,K=new WeakMap,Y=new WeakMap,J=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap;class re{constructor({label:e,key:t,type:n,dataType:r,depth:i=0,children:a,parent:o,group:s}){b(this,"label"),b(this,"key"),b(this,"type"),b(this,"dataType"),b(this,"depth"),b(this,"children"),b(this,"parent"),b(this,"group"),this.label=e,this.key=t,this.type=n,this.dataType=r??null,this.depth=i,this.parent=o??null,this.children=a??null,this.group=s??null}addChildren(e){return this.children=[...this.children||[],...e],this.children}getLeafColumns(){var e;return(e=this.children)!=null&&e.length?this.children.reduce(((e,t)=>[...e,...t.getLeafColumns()]),[]):[this]}}const ie=(e,t,n,r,a={})=>{const o=i();function s(n=false,r=null){const i=t.map((t=>new re({label:t.title,key:t.name,depth:e.length,type:S.ROW_HEADER,dataType:t.nativeType,parent:r})));return n?[new re({label:t.map((e=>e.title)).join(" → "),key:"__group.key",depth:e.length,type:S.ROW_HEADER_GROUP,group:i,parent:r})]:i}function l(e,n=0,r=null){if(!e.length)return s(a.aggregateRowDimensions&&t.length>1,r);const[i,...o]=e,u=new re({label:i.title,key:i.name,depth:n,type:S.DIMENSION,dataType:i.nativeType,parent:r}),c=l(o,n+1,u);return u.addChildren(c),[u]}function u(e,t=0,i=null,s=[]){if(!e.length)return n.map((e=>new re({label:e.title,key:R([...s,e.name]),depth:t,type:S.MEASURE,dataType:e.nativeType,parent:i||null})));const[l,...c]=e;return r[l.name].map((e=>{const n=new re({label:p(e,{...a.granularity&&l.nativeType==="time"&&e?{dateFormat:o.dateFormats[a.granularity]}:{}})??"-",key:R([...s,e]),depth:t,type:S.DIMENSION,dataType:l.nativeType,parent:i}),r=u(c,t+1,n,[...s,e]);return n.addChildren(r),n}))}const c=h.useMemo((()=>[...t.length?l(e):[],...u(e)]),[e,t,n,r,a.aggregateRowDimensions]),d=h.useMemo((()=>c.map((e=>e.getLeafColumns())).flat()),[c]);return{columns:c,getLeafColumns:()=>d}};function ae(e,t){return typeof t=="function"?t(e):e[t]}function oe(e){return!isNaN(e)}const se=e=>(t,n)=>{for(const{key:r,direction:i}of e){const e=ae(t,r)||0,a=ae(n,r)||0,o=le(e,a,i);if(o!==0)return o}return 0},le=(e,t,n)=>{if(oe(e)&&oe(t)){const r=parseInt(e,10),i=parseInt(t,10);return(r-i)*(n===a.ASCENDING?1:-1)}else return typeof e=="string"&&typeof t=="string"?e.localeCompare(t,void 0,{sensitivity:"base",numeric:true})*(n===a.ASCENDING?1:-1):typeof e=="number"?-1:1},ue=(e,t,n=[],r=[],i={})=>{const o=h.useMemo((()=>new ne(e,t,n,r,i.aggregateRowDimensions)),[e,t,n,r,i.aggregateRowDimensions]),s=h.useMemo((()=>r.reduce(((e,t)=>({...e,[t.name]:o.getColumnDimensionValues(t.name).sort(((e,t)=>le(e,t,i.defaultColumnsSort??a.ASCENDING)))})),{})),[r,o,i.defaultColumnsSort]),{columns:l,getLeafColumns:u}=ie(r,n,t,s,{aggregateRowDimensions:i.aggregateRowDimensions,granularity:i.granularity});return{rows:o.rows,columns:l,getLeafColumns:u}},ce=({aggregateRowDimensions:e=true,columnDimensions:t,columnSortingEnabled:n=true,data:r,defaultColumnDimensionSortDirection:a,defaultRowDimensionSortDirection:o,fontSize:l="14px",granularity:u,isRowGroupDefaultExpanded:c=true,measures:d,minColumnWidth:m,minRowDimensionColumnWidth:f,nullValueCharacter:y="",rowDimensions:g})=>{const b=i();l=b.font.size;const[w,v]=h.useState((()=>!g||!o?[]:[{key:g.length===1?g[0].name:"__group.key",direction:o}])),{rows:C,columns:D,getLeafColumns:k}=ue(r,d,g,t,{aggregateRowDimensions:e,defaultColumnsSort:a,granularity:u}),S=(e,t)=>{const n=[...e];return n.sort(se(t)),n.forEach((e=>{var n;(n=e.children)!=null&&n.length&&(e.children=S(e.children,t))})),n},x=h.useMemo((()=>{const e=parseInt(y,10);return w.map((t=>({...t,key:n=>n.data[t.key]||(isNaN(e)?null:e)})))}),[w]),N=h.useMemo((()=>S(C,x)),[C,x]),V=h.useMemo((()=>e=>d.find((t=>t.title===e))),[d]);return s.jsxs("table",{className:"min-w-full border-separate border-spacing-0 table-fixed",children:[s.jsx("thead",{className:`\n        embeddable-table-header\n        sticky\n        top-0\n        z-20\n        bg-[color:--embeddable-controls-backgrounds-colors-soft]\n      `,children:s.jsx(W,{columns:D,minColumnWidth:`${m}px`,minHeaderColumnWidth:`${f}px`,enableSorting:n,sortCriteria:w,onSortingChange:(e,t)=>{v([{key:e,direction:t}])},fontSize:l})}),s.jsx("tbody",{className:"overflow-y-auto",children:N.map((e=>s.jsx(M,{columns:k(),row:e,isRowGroupDefaultExpanded:c,renderCell:(e,t)=>{var n;const r=e[t.key];return typeof r=="boolean"?s.jsx("span",{style:{fontSize:l},children:r?"True":"False"}):s.jsx("span",{style:{fontSize:l},children:r==null?y:p(r,{...u&&t.dataType==="time"?{dateFormat:b.dateFormats[u]}:{},...V(t.label)?{meta:(n=V(t.label))==null?void 0:n.meta,type:"number"}:{}})})}},e.id)))})]})},de=({rowValues:t,columnValues:n,metrics:r,...i})=>{const a=[];return t!=null&&t.length&&i.aggregateRowDimensions?t==null||t.forEach(((e,t)=>{i[`resultsDimension${t}`]&&a.push(i[`resultsDimension${t}`])})):a.push(i.resultsDimension0),s.jsx(l,{title:i.title,results:a,description:i.description,className:"overflow-auto",children:a.every((e=>e&&!e.isLoading&&!e.error))&&s.jsx(ce,{...i,data:a.map((e=>e.data)),columnDimensions:n,defaultColumnDimensionSortDirection:i.columnSortDirection,rowDimensions:t==null?void 0:t.filter((t=>e(t))),defaultRowDimensionSortDirection:i.rowSortDirection,measures:r,fontSize:i.fontSize?`${i.fontSize}px`:void 0})})},he={name:"PivotTable",label:"Pivot table",classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",category:"Chart data"},{name:"metrics",type:"measure",label:"Metrics",array:true,config:{dataset:"ds"},category:"Chart data"},{name:"rowValues",type:"dimension",label:"Row Values",array:true,config:{dataset:"ds",hideGranularity:true},category:"Chart data"},{name:"columnValues",type:"dimension",label:"Column Values",array:true,config:{dataset:"ds",hideGranularity:true},category:"Chart data"},{name:"granularity",type:"granularity",label:"Granularity (for dates)",defaultValue:"week",category:"Variables to configure"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"nullValueCharacter",type:"string",label:"Null value character",description:"Character that should be displayed if value does not exist",defaultValue:"∅",category:"Chart settings"},{name:"isRowGroupDefaultExpanded",type:"boolean",label:"Row group expanded by default",defaultValue:false,category:"Chart settings"},{name:"columnSortingEnabled",type:"boolean",label:"Enable column sorting",defaultValue:true,category:"Chart settings"},{name:"rowSortDirection",type:o,defaultValue:{value:a.ASCENDING},label:"Default Row Sort Direction",category:"Chart settings"},{name:"columnSortDirection",type:o,defaultValue:{value:a.ASCENDING},label:"Default Column Sort Direction",category:"Chart settings"},{name:"minColumnWidth",type:"number",label:"Minimum metric column width in pixels",defaultValue:150,category:"Chart styling"},{name:"minRowDimensionColumnWidth",type:"number",label:"Minimum row value width in pixels",defaultValue:200,category:"Chart styling"},{name:"fontSize",type:"number",label:"Font size in pixels",category:"Chart styling"}]},me=true,pe=r(de,he,{props:(r,[i])=>{var o,s,l;const u=Array.isArray(r.rowValues)?r.rowValues:[r.rowValues],c=Array.isArray(r.columnValues)?r.columnValues:[r.columnValues],d=(u||[]).filter((t=>e(t))),h=(c||[]).filter((t=>e(t))),m=(o=r.metrics)==null?void 0:o.filter((e=>t(e))),p=d.filter((t=>t&&e(t))),f=p.map((e=>{var t;return{property:e,direction:((t=r.rowSortDirection)==null?void 0:t.value)===a.ASCENDING?"asc":"desc"}})),y=d!=null&&d.length&&me?d.reduce(((e,t,i,a)=>{const o=[...p.slice(0,i+1),...h];return{...e,[`resultsDimension${i}`]:n({from:r.ds,select:[...o.filter((e=>e.nativeType!=="time")),...o.filter((e=>e.nativeType==="time")).map((e=>({dimension:e.name,granularity:r.granularity}))),...m],orderBy:f.slice(0,i+1),limit:1e4})}}),{}):{resultsDimension0:n({from:r.ds,select:[{...[...p||[],...h].filter((e=>e.nativeType==="time")).map((e=>({dimension:e.name,granularity:r.granularity})))},...m],limit:1e4})};return{...r,rowValues:u,columnValues:h,rowSortDirection:(s=r.rowSortDirection)==null?void 0:s.value,columnSortDirection:(l=r.columnSortDirection)==null?void 0:l.value,measureVisualizationFormat:k.NUMERIC_VALUES_ONLY,aggregateRowDimensions:me,fontSize:r.fontSize,...y}}});export{pe as default,he as meta};
//# sourceMappingURL=p-CoJVf2F0.js.map