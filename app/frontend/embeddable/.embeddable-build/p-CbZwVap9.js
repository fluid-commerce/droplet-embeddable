import{z as e,D as l}from"./p-B7Yk6rNY.js";import{G as n,k as t,H as o}from"./p-C4wedjxV.js";import{D as r,o as a}from"./p-B2XW3qUq.js";import{S as s}from"./p-BG3D11hv.js";import{D as i}from"./p-BpMJ0iVV.js";import{P as d,G as c,O as u,V as m,k as p}from"./p-D9lurr2W.js";import{s as f}from"./p-Zw0IdN8R.js";import{c as b,d as h}from"./p-BvW5kj19.js";import"./p-CBK12GNN.js";import"./p-DgA2OfDc.js";const g=({currentPage:e,hasNextPage:l,onPageChange:n})=>s.jsxs("div",{className:`\n        flex\n        items-center\n        justify-center\n        left-0\n        select-none\n        sticky\n        font-[--embeddable-charts-fontWeights-pagination]\n        text-[color:--embeddable-font-colorNormal]\n        text-[size:--embeddable-font-size]\n      `,children:[s.jsx(m,{className:f(`\n            border\n            cursor-pointer\n            flex\n            h-8\n            hover:bg-black/10\n            items-center\n            justify-center\n            p-1\n            w-8\n            border-[color:--embeddable-controls-borders-colors-normal]\n            rounded-[--embeddable-controls-borders-radius]\n          `,{"opacity-50 pointer-events-none":e===0}),onClick:()=>{n==null||n(e-1)}}),s.jsxs("span",{className:"mx-4",children:["Page ",e+1]}),s.jsx(p,{className:f(`\n          border\n          cursor-pointer\n          flex\n          h-8\n          hover:bg-black/10\n          items-center\n          justify-center\n          p-1\n          w-8\n          border-[color:--embeddable-controls-borders-colors-normal]\n          rounded-[--embeddable-controls-borders-radius]\n          \n        `,{"opacity-50 pointer-events-none":!l}),onClick:()=>{n==null||n(e+1)}})]}),v=({columns:e,sortBy:l,sortDirection:n,onSortingChange:o,minColumnWidth:r})=>(t(),s.jsx("thead",{className:"border-y border-[color:--embeddable-controls-boders-colors-primary]",children:s.jsx("tr",{children:e==null?void 0:e.map((e=>{var t;const i=(l==null?void 0:l.name)===e.name,d=i?n===a.ASCENDING?a.DESCENDING:a.ASCENDING:a.ASCENDING;return s.jsx("th",{className:`\n                cursor-pointer\n                p-3\n                select-none\n                bg-[color:--embeddable-controls-backgrounds-colors-soft]\n              `,style:r?{minWidth:`${r}px`,maxWidth:`${r*1.2}px`}:{},onClick:()=>o==null?void 0:o(e,d),children:s.jsxs("div",{className:"flex items-center gap-1 hover:text-black",children:[s.jsx("span",{className:"embeddable-table-header mr-1 truncate",children:((t=e==null?void 0:e.inputs)==null?void 0:t.customColumnLabel)??e.title}),i?s.jsx("span",{className:"w-3",children:n===a.ASCENDING?s.jsx(c,{fill:"currentcolor"}):s.jsx(u,{fill:"currentcolor"})}):null]})},e.name)}))})})),y=l=>{var n,r,c,u,m,p,f,b,h,y;const{columns:C,results:N,allResults:w}=l,[D,S]=i.useState(false),[j,k]=i.useState(0),[V,P]=i.useState(false),W=t(),[B,z]=o({downloadAll:false,maxRowsFit:0,page:0,prevVariableValues:{},sort:l.defaultSort});i.useEffect((()=>{V||z((e=>({...e,maxRowsFit:j})))}),[l.columns,j,z,V]),i.useEffect((()=>{if(D){if(!w||!w.data||w.data.length===0)return;e(l,w==null?void 0:w.data,[],"downloaded-chart-data"),S(false),z((e=>({...e,downloadAll:false})))}}),[w,D,l,z]);const A=i.useCallback((({height:e})=>{var n,t;let o=0;const r=(e||76)-76,a=Math.floor(r/44);j===a&&a===o||((t=(n=l.results)==null?void 0:n.data)==null?void 0:t.length)===0||k(o=a)}),[j,l.results]),R=i.useCallback((()=>{z((e=>({...e,downloadAll:true}))),S(true)}),[z]),M=i.useCallback((e=>{var l;if(!B)return;const n=((l=B.sort)==null?void 0:l.slice())||[],t={asc:"desc",desc:"asc"},o=n.findIndex((l=>l.property.name===e.name));if(o===0)n[0]={...n[0],direction:t[n[0].direction]};else{const[e]=n.splice(o,1);n.unshift(e)}z((e=>({...e,sort:n,page:0})))}),[B,z]);return s.jsxs(d,{...l,childContainerClassName:"overflow-x-auto",className:"overflow-y-auto",downloadAllFunction:R,onResize:A,setResizeState:e=>P(e),children:[s.jsx("div",{style:{minWidth:`${(C==null?void 0:C.length)*(l.minColumnWidth??100)}px`},children:!!B&&!((n=l.results)!=null&&n.isLoading&&!((c=(r=l.results)==null?void 0:r.data)!=null&&c.length))&&s.jsxs("table",{className:"overflow-visible w-full",style:{fontSize:l.fontSize?`${l.fontSize}px`:W.font.size},children:[s.jsx(v,{columns:C,sortBy:(m=(u=B==null?void 0:B.sort)==null?void 0:u[0])==null?void 0:m.property,sortDirection:((f=(p=B==null?void 0:B.sort)==null?void 0:p[0])==null?void 0:f.direction)==="asc"?a.ASCENDING:a.DESCENDING,onSortingChange:M,minColumnWidth:l.minColumnWidth?l.minColumnWidth:void 0}),s.jsx("tbody",{children:(b=N==null?void 0:N.data)==null?void 0:b.slice(0,j).map(((e,n)=>s.jsx("tr",{className:"hover:bg-gray-400/5",children:C.map(((n,t)=>{const o=x(e[n.name],n);let r="";return typeof o=="object"?r=o.props.children:r=o,s.jsx("td",{className:"text-dark p-3 truncate",style:{fontSize:l.fontSize?`${l.fontSize}px`:W.font.size,maxWidth:l.minColumnWidth?`${l.minColumnWidth*1.2}px`:"auto"},children:s.jsx("span",{title:r,children:o})},t)}))},n)))})]})}),s.jsx(g,{currentPage:(B==null?void 0:B.page)||0,hasNextPage:l.limit&&(h=N==null?void 0:N.data)!=null&&h.length?((y=N==null?void 0:N.data)==null?void 0:y.length)<l.limit:false,onPageChange:e=>{z((l=>({...l,page:e})))}})]})};function x(e,l){if(typeof e=="number"||l.nativeType==="number")return b(`${e}`,{type:"number",meta:l==null?void 0:l.meta});if(typeof e=="boolean")return e?"True":"False";if(e&&l.nativeType==="time")return b(e,"date");const{linkText:n,linkUrl:t}=h(e);return n&&t?s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:n}):b(e)}const C={name:"TableChart",label:"Table",defaultHeight:300,defaultWidth:900,classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",description:"Dataset",defaultValue:false,category:"Chart data"},{name:"columns",type:"dimensionOrMeasure",label:"Columns",array:true,required:true,config:{dataset:"ds"},category:"Chart data",inputs:[{name:"customColumnLabel",type:"string",label:"Column Header",description:"Custom label to display instead of the default column header"}]},{name:"title",type:"string",label:"Title",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"maxPageRows",type:"number",label:"Max Page Rows",category:"Chart settings"},{name:"defaultSort",type:"dimensionOrMeasure",config:{dataset:"ds"},label:"Default Sort",category:"Chart settings"},{name:"defaultSortDirection",type:r,defaultValue:"Ascending",label:"Default Sort Direction",category:"Chart settings"},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true},{name:"minColumnWidth",type:"number",label:"Minimum column width in pixels",defaultValue:150,category:"Chart styling"},{name:"fontSize",type:"number",label:"Font size in pixels",category:"Chart styling"}]},N=n(y,C,{props:(e,[n])=>{var t,o,r;const a=((t=e==null?void 0:e.ds)==null?void 0:t.variableValues)||{},s=(n==null?void 0:n.prevVariableValues)||{},i=e.maxPageRows||n!=null&&n.maxRowsFit?Math.min(e.maxPageRows||1e3,Math.max(n==null?void 0:n.maxRowsFit,1)||1e3):0,d=((o=e.defaultSortDirection)==null?void 0:o.value)==="Ascending"?"asc":"desc",c=((r=e.columns)==null?void 0:r.filter((l=>{var n;return l.name!==((n=e.defaultSort)==null?void 0:n.name)})).map((e=>({property:e,direction:d}))))||[];e.defaultSort&&c.unshift({property:e.defaultSort,direction:d}),n&&JSON.stringify(a)!==JSON.stringify(s)&&(n.prevVariableValues=a,n.page=0);const u=i<1?{isLoading:true}:l({from:e.ds,select:e.columns,limit:i,offset:i*((n==null?void 0:n.page)||0),orderBy:(n==null?void 0:n.sort)||c}),m=l({from:e.ds,select:e.columns,limit:n!=null&&n.downloadAll?1e4:0,offset:0,orderBy:(n==null?void 0:n.sort)||c});return{...e,limit:i,defaultSort:c,results:u,allResults:m}}});export{N as default,C as meta};
//# sourceMappingURL=p-CbZwVap9.js.map