import{E as e,D as t}from"./p-DZclBDBz.js";import{G as a,k as l}from"./p-CptBl6Le.js";import{S as r}from"./p-D-ZJqqO3.js";import{W as s,F as n,b as o,w as i,a as u,Y as d,U as c,v as p,P as m,G as g,k as b,E as y,M as h}from"./p-CYoZIMuL.js";import{D as f}from"./p-UGbmf8ph.js";import{c as v}from"./p-BvW5kj19.js";import{P as C}from"./p-BDmepEmC.js";import"./p-CBK12GNN.js";import"./p-sWS4yEkp.js";i.register(u,d,c,p,m,g,b,y,h);const w=e=>{const{results:t,title:a,maxSegments:i,metric:u,slice:d,onClick:c,granularity:p}=e,m=l(),g=f.useMemo((()=>{var e;let a;return(d==null?void 0:d.nativeType)==="time"&&p&&p in m.dateFormats&&(a=m.dateFormats[p]),((e=t==null?void 0:t.data)==null?void 0:e.map((e=>({...e,...(d==null?void 0:d.name)&&{[d.name]:a?v(e==null?void 0:e[d.name],{meta:d==null?void 0:d.meta,dateFormat:a}):e==null?void 0:e[d.name]}}))))??[]}),[t==null?void 0:t.data,d,p,m.dateFormats]);s(m,"pie");let b=m.charts.colors;m.charts.pie.colors&&(b=m.charts.pie.colors);const y={...e,theme:m,results:{...t,data:g}},[h,w]=f.useState(null),k=f.useRef(null),S=e=>{if(!e.length||e[0].index===h){c({slice:null,metric:null}),w(null);return}const{index:t}=e[0];i&&t+1>=i||(w(t),c({slice:g==null?void 0:g[t][d.name],metric:g==null?void 0:g[t][u.name]}))},j=e=>{const{current:t}=k;t&&S(o(t,e))};return r.jsx(C,{...e,className:"overflow-y-hidden",children:r.jsx(n,{"aria-label":a?`Pie Chart: ${a}`:"Pie Chart","aria-roledescription":"pie chart",height:"100%",options:P(y,m),data:D(y,b),ref:k,onClick:j})})};function P(e,t){return{responsive:true,maintainAspectRatio:false,animation:{duration:400,easing:"linear"},cutout:"45%",plugins:{datalabels:{backgroundColor:t.charts.pie.labels.backgroundColor,borderRadius:t.charts.pie.labels.borderRadius,color:t.charts.pie.labels.color,display:e.showLabels?"auto":false,font:{size:t.charts.pie.labels.font.size,weight:t.charts.pie.labels.font.weight},formatter:t=>{const a=t?v(t,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta}):null;return e.displayAsPercentage?`${a}%`:a}},tooltip:{callbacks:{label:function(t){let a=t.dataset.label||"";return typeof t.dataset.label=="boolean"&&(a=t.dataset.label?"True":"False"),t.parsed!==null&&(a+=`: ${v(`${t.parsed||""}`,{type:"number",dps:e.dps,meta:e.displayAsPercentage?void 0:e.metric.meta})}`),a=e.displayAsPercentage?`${a}%`:a,a}}},legend:{display:e.showLegend,position:"bottom",labels:{usePointStyle:true,boxHeight:10}}}}}function k(e,t,a,l){if(!l||!a||!t)return e;const r=[...e||[]].sort(((e,t)=>parseInt(t[a.name])-parseInt(e[a.name]))).slice(0,l-1),s=e==null?void 0:e.slice(l-1).reduce(((e,t)=>e+parseInt(t[a.name])),0);return r.push({[t.name]:"Other",[a.name]:s}),r}function D(e,t){var a;const{maxSegments:l,results:r,metric:s,slice:n,displayAsPercentage:o,theme:i}=e,u=l&&l<(((a=r==null?void 0:r.data)==null?void 0:a.length)||0)?k(r.data||[],n,s,l):r.data,d=u==null?void 0:u.map((e=>e[n.name])),c=o?u==null?void 0:u.reduce(((e,t)=>e+parseFloat(t[s.name])),0):null,p=u==null?void 0:u.map((e=>{const t=parseFloat(e[s.name]);return o&&c?t*100/c:t}));return{labels:d,datasets:[{data:p,backgroundColor:t,borderColor:i.charts.pie.borderColor,borderWidth:i.charts.pie.borderWidth,weight:i.charts.pie.weight}]}}const S={name:"PieChart",label:"Pie chart",classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",category:"Chart data"},{name:"slice",type:"dimension",label:"Slice",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"metric",type:"measure",label:"Metric",required:true,config:{dataset:"ds"},category:"Chart data"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"showLegend",type:"boolean",label:"Turn on the legend",defaultValue:true,category:"Chart settings"},{name:"maxSegments",type:"number",label:"Max Legend items",defaultValue:8,category:"Chart settings"},{name:"showLabels",type:"boolean",label:"Show Labels",defaultValue:false,category:"Chart settings"},{name:"displayAsPercentage",type:"boolean",label:"Display as Percentages",defaultValue:false,category:"Chart settings"},{name:"dps",type:"number",label:"Decimal Places",category:"Formatting"},{name:"enableDownloadAsCSV",type:"boolean",label:"Show download as CSV",category:"Export options",defaultValue:true},{name:"enableDownloadAsPNG",type:"boolean",label:"Show download as PNG",category:"Export options",defaultValue:true}],events:[{name:"onClick",label:"Click",properties:[{name:"slice",type:"string"},{name:"metric",type:"number"}]}]},j=a(w,S,{props:e=>{var a,l;return{...e,granularity:(l=(a=e.slice)==null?void 0:a.inputs)==null?void 0:l.granularity,results:t({from:e.ds,select:[e.slice,e.metric]})}},events:{onClick:t=>({slice:t.slice||e.noFilter(),metric:t.metric||e.noFilter()})}});export{j as default,S as meta};
//# sourceMappingURL=p-CC2N9epv.js.map