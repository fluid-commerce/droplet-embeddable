{"version":3,"file":"index-VjD1R8dk-Bm9w8E8M-DeQW__zM.js","sources":["../../../node_modules/@embeddable.com/vanilla-components/src/components/vanilla/charts/KPIChart/index.tsx"],"sourcesContent":["import { DataResponse, Dimension, Measure, TimeRange } from '@embeddable.com/core';\nimport React, { useMemo } from 'react';\n\nimport formatValue from '../../../util/format';\nimport Container from '../../Container';\nimport { WarningIcon } from '../../icons';\nimport { Theme } from '../../../../themes/theme';\nimport { useTheme } from '@embeddable.com/react';\n\ntype Props = {\n  results: DataResponse;\n  prevResults?: DataResponse;\n  prevTimeFilter?: TimeRange;\n  title?: string;\n  prefix?: string;\n  suffix?: string;\n  metric?: Measure;\n  displayMetric?: boolean;\n  dimension?: Dimension;\n  dps?: number;\n  fontSize?: number;\n  showPrevPeriodLabel?: boolean;\n};\n\nexport default (props: Props) => {\n  const {\n    results,\n    prevResults,\n    prevTimeFilter,\n    metric,\n    displayMetric,\n    dimension,\n    dps,\n    prefix,\n    suffix,\n    showPrevPeriodLabel,\n  } = props;\n\n  const theme: Theme = useTheme() as Theme;\n\n  const { n, percentage } = useMemo(() => {\n    if (dimension || !metric?.name || !results?.data?.length) {\n      return { percentage: null, n: null }; // Skip calculations\n    }\n\n    const n = parseFloat(results?.data?.[0]?.[metric.name] || 0);\n    const prev = parseFloat(prevResults?.data?.[0]?.[metric.name] || 0);\n\n    return {\n      percentage: prev || prev === 0 ? Math.round((n / prev) * 100) - 100 : null,\n      n: formatValue(n.toString(), {\n        type: 'number',\n        meta: metric?.meta,\n        dps: dps,\n      }),\n    };\n  }, [results, prevResults, metric, dps, dimension]);\n\n  const fontSize = props.fontSize || theme.charts.kpi.font.size;\n  const metaFontSize = Math.max(fontSize / 3, parseInt(theme.font.size.replace('px', ''), 10));\n  const fontColor = theme.font.colorNormal;\n  const negativeColor = theme.charts.kpi.font.negativeColor;\n\n  if (results?.error) {\n    return (\n      <div className=\"h-full flex items-center justify-center font-embeddable text-sm\">\n        <WarningIcon />\n        <div className=\"whitespace-pre-wrap p-4 max-w-sm text-xs\">{results?.error}</div>\n      </div>\n    );\n  }\n\n  return (\n    <Container {...props} className=\"overflow-y-hidden\">\n      <div\n        className={`\n          flex\n          flex-col\n          font-embeddable\n          h-full\n          items-${theme.charts.kpi?.alignment || 'center'}\n          justify-center\n          leading-tight\n          relative\n          text-${theme.charts.kpi?.alignment || 'center'}\n          font-[--embeddable-charts-fontWeights-kpiNumber]\n        `}\n      >\n        {dimension ? (\n          <>\n            <div\n              className={`text-[color:--embeddable-font-colorNormal]`}\n              style={{ fontSize: `${fontSize}px` }}\n            >\n              <p>{results?.data?.[0]?.[dimension.name]}</p>\n            </div>\n            {displayMetric && metric && (\n              <p\n                className={`font-normal`}\n                style={{\n                  fontSize: `${metaFontSize}px`,\n                  color: fontColor,\n                }}\n              >\n                {`${metric.title}: ${formatValue(`${results?.data?.[0]?.[metric.name]}`, {\n                  type: 'number',\n                  dps: dps,\n                  meta: metric?.meta,\n                })}\n                `}\n              </p>\n            )}\n          </>\n        ) : (\n          <>\n            <div\n              className={`text-[color:--embeddable-font-colorNormal]`}\n              style={{ fontSize: `${fontSize}px` }}\n            >\n              <p>{`${prefix || ''}${n || 0}${suffix || ''}`}</p>\n            </div>\n            {prevTimeFilter?.to && (\n              <div\n                className={`\n                  flex\n                  flex-wrap\n                  font-normal\n                  items-${theme.charts.kpi?.alignment || 'center'}\n                  justify-center\n                  text-${theme.charts.kpi?.alignment || 'center'}\n                `}\n                style={{\n                  color: percentage && percentage < 0 ? negativeColor : fontColor,\n                  fontSize: `${metaFontSize}px`,\n                }}\n              >\n                <Chevron\n                  className={`${percentage && percentage < 0 ? 'rotate-180' : ''} h-[20px] w-[9px] min-w-[9px] mr-1.5`}\n                />\n                <span>\n                  {percentage === Infinity\n                    ? 'âˆž'\n                    : `${formatValue(`${Math.abs(percentage || 0)}`, { type: 'number', dps: dps })}%`}\n                </span>\n                {showPrevPeriodLabel &&\n                  prevTimeFilter?.relativeTimeString &&\n                  prevTimeFilter.relativeTimeString.length > 0 && (\n                    <span style={{ color: fontColor }}>\n                      &nbsp;\n                      {`vs ${prevTimeFilter.relativeTimeString}`}\n                    </span>\n                  )}\n              </div>\n            )}\n          </>\n        )}\n      </div>\n    </Container>\n  );\n};\n\nexport const Chevron = ({ className }: { className?: string }) => (\n  <svg\n    className={className || ''}\n    width=\"16\"\n    height=\"14\"\n    viewBox=\"0 0 16 14\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M7.14028 0.753268C7.5422 0.0998221 8.4578 0.099822 8.85972 0.753268L15.8366 12.0964C16.2727 12.8054 15.7846 13.7369 14.9769 13.7369H1.02308C0.215416 13.7369 -0.272737 12.8054 0.163359 12.0964L7.14028 0.753268Z\"\n      fill=\"currentcolor\"\n    />\n  </svg>\n);\n"],"names":["jsx","className","Chevron","prevTimeFilter","showPrevPeriodLabel","jsxs","fontColor","percentage","formatValue","dps","metaFontSize","negativeColor","_h","theme","_g","prefix","n","suffix","fontSize","Fragment","metric","_f","_e","results","displayMetric","_d","_c","dimension","_b","_a","Container","props","WarningIcon","prevResults","prev","useTheme","useMemo","Component"],"mappings":"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"}