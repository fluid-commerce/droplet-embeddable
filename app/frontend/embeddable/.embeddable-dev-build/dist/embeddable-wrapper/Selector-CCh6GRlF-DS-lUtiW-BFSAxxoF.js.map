{"version":3,"file":"Selector-CCh6GRlF-DS-lUtiW-BFSAxxoF.js","sources":["../../../node_modules/@embeddable.com/vanilla-components/src/components/vanilla/controls/Selector.tsx"],"sourcesContent":["import React, {\n  ReactNode,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { twMerge } from 'tailwind-merge';\nimport Container from '../Container';\nimport { ChevronDown, ClearIcon } from '../icons';\nimport { SelectorOption } from './Selector.types';\nimport { selectorOptionIncludesSearch } from './Selector.utils';\n\nexport type Props = {\n  className?: string;\n  minDropdownWidth?: number;\n  placeholder?: string;\n  defaultValue?: string;\n  options: SelectorOption[];\n  title?: string;\n  unclearable?: boolean;\n  onChange: (v: string) => void;\n};\n\nexport default (props: Props) => {\n  const ref = useRef<HTMLInputElement | null>(null);\n\n  const [focus, setFocus] = useState(false);\n  const [isDropdownOrItemFocused, setIsDropdownOrItemFocused] = useState(false);\n  const [search, setSearch] = useState('');\n  const [triggerBlur, setTriggerBlur] = useState(false);\n  const [value, setValue] = useState(props.defaultValue);\n\n  const valueLabel: string | undefined = props.options.find(\n    (option) => option.value === value,\n  )?.label;\n\n  useEffect(() => {\n    setValue(props.defaultValue);\n  }, [props.defaultValue]);\n\n  // Accessibility - Close the menu if we've tabbed off of any items it contains\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout | null = null;\n\n    if (!isDropdownOrItemFocused) {\n      timeoutId = setTimeout(() => {\n        setFocus(false);\n      }, 200);\n    } else {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    }\n\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    };\n  }, [isDropdownOrItemFocused]);\n\n  useLayoutEffect(() => {\n    if (!triggerBlur) return;\n\n    const timeout = setTimeout(() => {\n      setFocus(false);\n      setTriggerBlur(false);\n    }, 500);\n\n    return () => clearTimeout(timeout);\n  }, [triggerBlur]);\n\n  const performSearch = useCallback(\n    (newSearch: string) => {\n      setSearch(newSearch);\n    },\n    [setSearch],\n  );\n\n  const setDropdownValue = useCallback(\n    (value: string) => {\n      performSearch('');\n      setValue(value);\n      props.onChange(value);\n    },\n    [setValue, props, performSearch],\n  );\n\n  // Used for handling keydown events on the menu items\n  const handleKeyDownCallback = (\n    e: React.KeyboardEvent<HTMLElement>,\n    callback: any,\n    escapable?: boolean,\n  ) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      callback(e);\n      setFocus(false);\n      setTriggerBlur(true);\n    }\n    if (escapable && e.key === 'Escape') {\n      e.preventDefault();\n      setFocus(false);\n      setTriggerBlur(true);\n    }\n  };\n\n  const list = useMemo(() => {\n    return props.options\n      .filter((option) => selectorOptionIncludesSearch(search, option))\n      .map((option) => (\n        <div\n          key={option.value}\n          role=\"button\"\n          onClick={() => {\n            setFocus(false);\n            setTriggerBlur(true);\n            setDropdownValue(option.value);\n          }}\n          onKeyDown={(e) => {\n            handleKeyDownCallback(\n              e,\n              () => {\n                setDropdownValue(option.value);\n              },\n              true,\n            );\n          }}\n          className={`flex items-center min-h-[36px] px-3 py-2 hover:bg-black/5 cursor-pointer font-normal ${\n            value === option.value ? 'bg-black/5' : ''\n          } whitespace-nowrap overflow-hidden text-ellipsis`}\n          tabIndex={0}\n        >\n          {option.label}\n        </div>\n      ));\n  }, [props.options, value, setDropdownValue, search]) as ReactNode[];\n\n  return (\n    <Container title={props.title}>\n      <div\n        className={twMerge(\n          'relative rounded-xl w-full min-w-[50px] h-10 border border-[#DADCE1] flex items-center',\n          props.className,\n        )}\n      >\n        <input\n          ref={ref}\n          value={search}\n          name=\"dropdown\"\n          placeholder={props.placeholder}\n          onClick={() => {\n            setFocus(true);\n            setTriggerBlur(false);\n          }}\n          onFocus={() => {\n            setFocus(true);\n            setTriggerBlur(false);\n            setIsDropdownOrItemFocused(true);\n          }}\n          onBlur={() => {\n            setIsDropdownOrItemFocused(false);\n          }}\n          onChange={(e) => performSearch(e.target.value)}\n          className={`outline-none bg-transparent leading-9 h-9 border-0 px-3 w-full cursor-pointer text-sm ${\n            focus || !value ? '' : 'opacity-0'\n          }`}\n        />\n\n        {valueLabel && (\n          <span\n            className={`absolute w-[calc(100%-2.5rem)] whitespace-nowrap overflow-hidden truncate rounded-xl left-3 top-1 h-8 leading-8 block pointer-events-none text-sm ${\n              focus ? 'hidden' : ''\n            }`}\n          >\n            {valueLabel}\n          </span>\n        )}\n\n        {focus && (\n          <div\n            style={{ minWidth: props.minDropdownWidth }}\n            className=\"flex flex-col bg-white rounded-xl absolute top-11 z-50 border border-[#DADCE1] w-full overflow-y-auto overflow-x-hidden max-h-[400px]\"\n            onMouseDown={(e) => {\n              e.preventDefault();\n              // re-focus the input (allows repeated clicking in and out)\n              ref.current?.focus();\n              setTriggerBlur(false);\n            }}\n            onFocus={() => {\n              setIsDropdownOrItemFocused(true);\n            }}\n            onBlur={() => {\n              setIsDropdownOrItemFocused(false);\n            }}\n            tabIndex={0}\n          >\n            {list}\n            {list?.length === 0 && !!search && (\n              <div className=\"px-3 py-2 text-black/50 italic cursor-pointer\">No results</div>\n            )}\n          </div>\n        )}\n\n        <ChevronDown className=\"absolute right-2 top-2.5 z-1 pointer-events-none\" />\n\n        {!props.unclearable && !!value && (\n          <div\n            onClick={() => {\n              setDropdownValue('');\n            }}\n            className=\"absolute right-10 top-0 h-10 flex items-center z-10 cursor-pointer\"\n          >\n            <ClearIcon />\n          </div>\n        )}\n      </div>\n    </Container>\n  );\n};\n"],"names":["ClearIcon","setDropdownValue","jsx","props","value","ChevronDown","list","search","setIsDropdownOrItemFocused","_a","ref","setTriggerBlur","jsxs","focus","valueLabel","performSearch","setFocus","twMerge","I","Container","option","e","handleKeyDownCallback","j","useMemo","selectorOptionIncludesSearch","callback","escapable","setValue","useCallback","C","setSearch","newSearch","triggerBlur","timeout","isDropdownOrItemFocused","useLayoutEffect","timeoutId","useEffect","D","useRef","useState","Selector"],"mappings":"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"}