{"version":3,"file":"MultiSelector-B-FnhZ4g-DZ3NmSFU-BZYo2Q7C.js","sources":["../../../node_modules/@embeddable.com/vanilla-components/src/components/vanilla/controls/MultiSelector.tsx"],"sourcesContent":["import { useEmbeddableState } from '@embeddable.com/react';\nimport React, {\n  ReactNode,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { twMerge } from 'tailwind-merge';\nimport Checkbox from '../../icons/Checkbox';\nimport CheckboxEmpty from '../../icons/CheckboxEmpty';\nimport Container from '../Container';\nimport { ChevronDown, ClearIcon } from '../icons';\nimport { SelectorOption } from './Selector.types';\nimport { selectorOptionIncludesSearch } from './Selector.utils';\n\nexport type Props = {\n  className?: string;\n  minDropdownWidth?: number;\n  placeholder?: string;\n  defaultValue?: string[];\n  options: SelectorOption[];\n  title?: string;\n  unclearable?: boolean;\n  onChange: (v: string[]) => void;\n};\n\nexport default (props: Props) => {\n  const ref = useRef<HTMLInputElement | null>(null);\n\n  const [focus, setFocus] = useState(false);\n  const [isDropdownOrItemFocused, setIsDropdownOrItemFocused] = useState(false);\n  const [search, setSearch] = useState('');\n  const [triggerBlur, setTriggerBlur] = useState(false);\n  const [value, setValue] = useState(props.defaultValue);\n\n  useEffect(() => {\n    setValue(props.defaultValue);\n  }, [props.defaultValue]);\n\n  // Accessibility - Close the menu if we've tabbed off of any items it contains\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout | null = null;\n\n    if (!isDropdownOrItemFocused) {\n      timeoutId = setTimeout(() => {\n        setFocus(false);\n      }, 200);\n    } else {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    }\n\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    };\n  }, [isDropdownOrItemFocused]);\n\n  useLayoutEffect(() => {\n    if (!triggerBlur) return;\n\n    const timeout = setTimeout(() => {\n      setFocus(false);\n      setTriggerBlur(false);\n    }, 500);\n\n    return () => clearTimeout(timeout);\n  }, [triggerBlur]);\n\n  const performSearch = useCallback(\n    (newSearch: string) => {\n      setSearch(newSearch);\n    },\n    [setSearch],\n  );\n\n  const set = useCallback(\n    (newValue: string) => {\n      performSearch('');\n\n      let newValues: string[] = [];\n\n      if (newValue !== '') {\n        newValues = value || [];\n        if (newValues?.includes(newValue)) {\n          newValues = newValues.filter((v) => v !== newValue);\n        } else {\n          newValues = [...newValues, newValue];\n        }\n      }\n\n      props.onChange(newValues);\n      setValue(newValues);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [performSearch, props, value],\n  );\n\n  // Used for handling keydown events on the menu items\n  const handleKeyDownCallback = (\n    e: React.KeyboardEvent<HTMLElement>,\n    callback: any,\n    escapable?: boolean,\n  ) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      callback(e);\n    }\n    if (escapable && e.key === 'Escape') {\n      e.preventDefault();\n      setFocus(false);\n      setTriggerBlur(true);\n    }\n  };\n\n  const list = useMemo(() => {\n    return props.options\n      .filter((option) => selectorOptionIncludesSearch(search, option))\n      .map((option) => {\n        return (\n          <div\n            key={option.value}\n            role=\"button\"\n            onClick={() => {\n              setTriggerBlur(false);\n              set(option.value);\n            }}\n            onKeyDown={(e) => handleKeyDownCallback(e, set(option.value), true)}\n            onFocus={() => {\n              setIsDropdownOrItemFocused(true);\n              setFocus(true);\n            }}\n            onBlur={() => {\n              setIsDropdownOrItemFocused(false);\n            }}\n            className={`flex items-left items-center min-h-[36px] px-3 py-2 hover:bg-black/5 cursor-pointer font-normal ${\n              value?.includes(option.value) ? 'bg-black/5' : ''\n            } truncate`}\n            tabIndex={0}\n          >\n            {value?.includes(option.value) ? <Checkbox /> : <CheckboxEmpty />}\n            <span className=\"font-normal pl-1 truncate\" title={option.label}>\n              {option.label}\n            </span>\n          </div>\n        );\n      });\n  }, [props, value, set, search]) as ReactNode[];\n\n  return (\n    <Container title={props.title}>\n      <div\n        className={twMerge(\n          'relative rounded-xl w-full min-w-[50px] h-10 border border-[#DADCE1] flex items-center',\n          props.className,\n        )}\n      >\n        <input\n          ref={ref}\n          value={search}\n          name=\"dropdown\"\n          placeholder={props.placeholder}\n          onClick={() => {\n            setFocus(true);\n            setTriggerBlur(false);\n          }}\n          onFocus={() => {\n            setFocus(true);\n            setTriggerBlur(false);\n            setIsDropdownOrItemFocused(true);\n          }}\n          onBlur={() => {\n            setIsDropdownOrItemFocused(false);\n          }}\n          onChange={(e) => performSearch(e.target.value)}\n          className={`outline-none bg-transparent leading-9 h-9 border-0 px-3 w-full cursor-pointer text-sm ${\n            focus || !value ? '' : 'opacity-0'\n          }`}\n        />\n\n        {!!value && (\n          <span\n            className={`absolute w-[calc(100%-2rem)] whitespace-nowrap overflow-hidden truncate rounded-xl left-3 top-1 h-8 leading-8 block pointer-events-none text-sm ${\n              focus ? 'hidden' : ''\n            }`}\n          >\n            Selected {value.length} {value.length === 1 ? 'option' : 'options'}\n          </span>\n        )}\n\n        {focus && (\n          <div\n            style={{ minWidth: props.minDropdownWidth }}\n            className=\"flex flex-col bg-white rounded-xl absolute top-11 z-50 border border-[#DADCE1] w-full overflow-y-auto overflow-x-hidden max-h-[400px]\"\n            onMouseDown={(e) => {\n              e.preventDefault();\n              // re-focus the input (allows repeated clicking in and out)\n              ref.current?.focus();\n              setTriggerBlur(false);\n            }}\n            onFocus={() => {\n              setIsDropdownOrItemFocused(true);\n            }}\n            onBlur={() => {\n              setIsDropdownOrItemFocused(false);\n            }}\n            tabIndex={0}\n          >\n            {list}\n            {list?.length === 0 && !!search && (\n              <div className=\"px-3 py-2 text-black/50 italic cursor-pointer\">No results</div>\n            )}\n          </div>\n        )}\n\n        <ChevronDown className=\"absolute right-2.5 top-2.5 z-1 pointer-events-none\" />\n\n        {!props.unclearable && !!value && (\n          <div\n            onClick={() => {\n              set('');\n            }}\n            className=\"absolute right-10 top-0 h-10 flex items-center z-10 cursor-pointer\"\n          >\n            <ClearIcon />\n          </div>\n        )}\n      </div>\n    </Container>\n  );\n};\n"],"names":["ClearIcon","set","jsx","props","value","ChevronDown","list","search","setIsDropdownOrItemFocused","o","_a","ref","setTriggerBlur","jsxs","focus","performSearch","setFocus","h","twMerge","N","Container","option","Checkbox","CheckboxEmpty","e","handleKeyDownCallback","useMemo","selectorOptionIncludesSearch","callback","escapable","newValue","newValues","v","setValue","useCallback","C","setSearch","newSearch","triggerBlur","timeout","isDropdownOrItemFocused","useLayoutEffect","timeoutId","useEffect","w","useRef","useState","MultiSelector"],"mappings":"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"}