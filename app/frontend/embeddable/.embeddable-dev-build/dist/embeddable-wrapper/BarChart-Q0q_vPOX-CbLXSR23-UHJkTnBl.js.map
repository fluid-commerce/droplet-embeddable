{"version":3,"file":"BarChart-Q0q_vPOX-CbLXSR23-UHJkTnBl.js","sources":["../../../node_modules/@embeddable.com/vanilla-components/src/components/vanilla/charts/BarChart/components/BarChart.tsx"],"sourcesContent":["import { DataResponse, Dimension, Granularity, Measure } from '@embeddable.com/core';\nimport {\n  BarElement,\n  CategoryScale,\n  ChartData,\n  Chart as ChartJS,\n  Filler,\n  Legend,\n  PointElement,\n  LineElement,\n  LinearScale,\n  Title,\n  Tooltip,\n} from 'chart.js';\nimport ChartDataLabels from 'chartjs-plugin-datalabels';\nimport { Chart } from 'react-chartjs-2';\n\nimport formatValue from '../../../../util/format';\nimport getBarChartOptions from '../../../../util/getBarChartOptions';\nimport { setChartJSDefaults } from '../../../../util/chartjs/common';\nimport { Theme } from '../../../../../themes/theme';\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  BarElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n  Filler,\n  ChartDataLabels,\n);\n\ntype Props = {\n  description?: string;\n  displayHorizontally?: boolean;\n  dps?: number;\n  enableDownloadAsCSV?: boolean;\n  metrics: Measure[];\n  lineMetrics?: Measure[];\n  results?: DataResponse;\n  reverseXAxis?: boolean;\n  showLabels?: boolean;\n  showLegend?: boolean;\n  sortBy?: Dimension | Measure;\n  stackMetrics?: boolean;\n  title?: string;\n  xAxis: Dimension;\n  xAxisTitle?: string;\n  yAxisTitle?: string;\n  showSecondYAxis?: boolean;\n  secondAxisTitle?: string;\n  theme: Theme;\n};\n\nexport default function BarChart({ ...props }: Props): React.JSX.Element {\n  return (\n    <Chart\n      type=\"bar\"\n      height=\"100%\"\n      options={getBarChartOptions({ ...props, stacked: false })}\n      data={chartData(props)}\n    />\n  );\n}\n\nfunction chartData(props: Props): ChartData<'bar' | 'line'> {\n  const { results, xAxis, metrics, lineMetrics, showSecondYAxis, theme } = props;\n  const granularity = xAxis?.inputs?.granularity;\n  const {\n    charts: { colors },\n    dateFormats,\n  } = theme;\n  setChartJSDefaults(theme);\n\n  // Check for bar chart color overrides in theme\n  let chartColors = colors;\n  if (theme.charts.bar.colors) {\n    chartColors = theme.charts.bar.colors;\n  }\n  const isTimeDimension = xAxis?.nativeType === 'time';\n\n  let dateFormat: string | undefined;\n  if (granularity && granularity in dateFormats) {\n    dateFormat = dateFormats[granularity];\n  }\n  const labels = [\n    ...new Set(\n      results?.data?.map((d: { [p: string]: string }) => {\n        const value = d[xAxis?.name];\n        return formatValue(value ?? '', {\n          meta: xAxis?.meta,\n          ...(isTimeDimension ? { dateFormat } : {}),\n        });\n      }),\n    ),\n  ] as string[];\n\n  const metricsDatasets =\n    metrics?.map((metric, i) => ({\n      backgroundColor: chartColors[i % chartColors.length],\n      barPercentage: 0.8,\n      barThickness: 'flex',\n      borderRadius: theme.charts.bar.borderRadius,\n      borderSkipped: theme.charts.bar.borderSkipped,\n      borderWidth: theme.charts.bar.borderWidth,\n      data: results?.data?.map((d) => parseFloat(d[metric.name] || 0)) || [],\n      label: metric.title,\n      maxBarThickness: 50,\n      minBarLength: 0,\n      order: 1,\n    })) || [];\n\n  //optional metrics to display as a line on the barchart\n  const lineMetricsDatasets =\n    lineMetrics?.map((metric, i) => ({\n      backgroundColor: chartColors[metrics.length + (i % chartColors.length)],\n      borderColor: chartColors[metrics.length + (i % chartColors.length)],\n      cubicInterpolationMode: theme.charts.bar.cubicInterpolationMode,\n      data: results?.data?.map((d) => parseFloat(d[metric.name] || 0)) || [],\n      label: metric.title,\n      order: 0,\n      pointHoverRadius: 3,\n      pointRadius: 2,\n      tension: theme.charts.bar.lineTension,\n      type: 'line' as const,\n      yAxisID: showSecondYAxis ? 'y1' : 'y',\n    })) || [];\n\n  return {\n    labels,\n    datasets: [...metricsDatasets, ...lineMetricsDatasets],\n  };\n}\n"],"names":["labels","metricsDatasets","lineMetricsDatasets","showSecondYAxis","theme","metric","_a","results","d","chartColors","metrics","i","lineMetrics","isTimeDimension","dateFormat","xAxis","formatValue","value","_b","granularity","dateFormats","colors","setChartJSDefaults","M","props","chartData","getBarChartOptions","Chart","jsx","BarChart","Filler","ChartDataLabels","Legend","Tooltip","Title","j","LineElement","L","BarElement","F","PointElement","E","LinearScale","T","CategoryScale","R","ChartJS"],"mappings":"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"}