{"version":3,"file":"index-BKNn0bB9-DCRB_cuI-Cdxm0dsa.js","sources":["../../../node_modules/@embeddable.com/vanilla-components/src/components/vanilla/charts/StackedAreaChart/index.tsx"],"sourcesContent":["import {\n  CategoryScale,\n  ChartData,\n  Chart as ChartJS,\n  ChartOptions,\n  Filler,\n  Legend,\n  LineElement,\n  LinearScale,\n  PointElement,\n  TimeScale,\n  Title,\n  Tooltip,\n} from 'chart.js';\nimport 'chart.js/auto';\nimport 'chartjs-adapter-date-fns';\nimport ChartDataLabels from 'chartjs-plugin-datalabels';\nimport React, { useMemo } from 'react';\nimport { Line } from 'react-chartjs-2';\nimport useTimeseries from '../../../hooks/useTimeseries';\nimport formatValue from '../../../util/format';\nimport formatDateTooltips from '../../../util/formatDateTooltips';\nimport getStackedChartData, {\n  Props as GeneralStackedChartDataProps,\n} from '../../../util/getStackedChartData';\nimport Container from '../../Container';\nimport { setYAxisStepSize } from '../../../util/chartjs/common';\nimport { useTheme } from '@embeddable.com/react';\nimport { setChartJSDefaults } from '../../../util/chartjs/common';\nimport { Theme } from '../../../../themes/theme';\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n  Filler,\n  ChartDataLabels,\n  TimeScale,\n);\n\ntype Props = GeneralStackedChartDataProps & {\n  isMultiDimensionLine?: boolean;\n};\n\ntype PropsWithRequiredTheme = Props & { theme: Theme };\n\nexport default (props: Props) => {\n  const { isMultiDimensionLine = false } = props;\n  const theme: Theme = useTheme() as Theme;\n\n  // Set ChartJS defaults\n  setChartJSDefaults(theme, 'pie');\n\n  // Add the theme to props\n  const updatedProps: PropsWithRequiredTheme = {\n    ...props,\n    theme,\n  };\n\n  const { fillGaps } = useTimeseries(updatedProps, 'desc');\n\n  const chartData = useMemo(() => {\n    const data = updatedProps?.results?.data?.reduce(fillGaps, []);\n\n    const datasetsMeta = {\n      fill: !isMultiDimensionLine,\n      cubicInterpolationMode: theme.charts.stackedArea.cubicInterpolationMode,\n      pointRadius: 0,\n      tension: theme.charts.stackedArea.lineTension,\n      pointHoverRadius: 3,\n    };\n\n    return getStackedChartData(\n      {\n        ...updatedProps,\n        results: {\n          ...updatedProps.results,\n          data,\n        },\n      },\n      datasetsMeta,\n      { chartType: 'stackedAreaChart' },\n    ) as ChartData<'line', number[], unknown>;\n  }, [updatedProps, fillGaps]);\n\n  const chartOptions: ChartOptions<'line'> = useMemo(() => {\n    return {\n      responsive: true,\n      maintainAspectRatio: false,\n      interaction: {\n        mode: 'index',\n        intersect: false,\n      },\n      layout: {\n        padding: {\n          left: 0,\n          right: 0,\n          top: updatedProps.showLabels ? 20 : 0, // Added so the highest data labels fits\n          bottom: 0,\n        },\n      },\n      scales: {\n        y: {\n          stacked: !isMultiDimensionLine,\n          min: updatedProps.yAxisMin,\n          max: updatedProps.displayAsPercentage ? 100 : undefined,\n          grace: '0%', // Add percent to add numbers on the y-axis above and below the max and min values\n          grid: {\n            display: false,\n          },\n          ticks: {\n            callback: function (value) {\n              return updatedProps.displayAsPercentage\n                ? `${value}%`\n                : formatValue(value.toString(), { type: 'number' });\n            },\n          },\n          title: {\n            display: !!updatedProps.yAxisTitle,\n            text: updatedProps.yAxisTitle,\n          },\n          afterDataLimits: function (axis) {\n            setYAxisStepSize(axis, updatedProps.results, [updatedProps.metric], updatedProps.dps);\n          },\n        },\n        x: {\n          grid: {\n            display: false,\n          },\n          title: {\n            display: !!updatedProps.xAxisTitle,\n            text: updatedProps.xAxisTitle,\n          },\n          type: 'time',\n          time: {\n            round: updatedProps.granularity,\n            displayFormats: theme.dateFormats,\n            unit: updatedProps.granularity,\n          },\n        },\n      },\n      animation: {\n        duration: 400,\n        easing: 'linear',\n      },\n      plugins: {\n        legend: {\n          display: updatedProps.showLegend,\n          position: 'bottom',\n          labels: {\n            usePointStyle: true,\n            boxHeight: 8,\n          },\n        },\n        tooltip: {\n          //https://www.chartjs.org/docs/latest/configuration/tooltip.html\n          callbacks: {\n            label: function (context) {\n              let label = context.dataset.label || '';\n              if (context.parsed.y !== null) {\n                label += `: ${formatValue(`${context.parsed['y']}`, {\n                  type: 'number',\n                  dps: updatedProps.dps,\n                  meta: updatedProps.displayAsPercentage ? undefined : updatedProps.metric.meta,\n                })}`;\n                if (updatedProps.displayAsPercentage) {\n                  label += '%';\n                }\n              }\n              return label;\n            },\n            title: (lines: any[]) =>\n              formatDateTooltips(lines, updatedProps.granularity || 'day', theme),\n          },\n        },\n        datalabels: {\n          align: 'top',\n          display: updatedProps.showLabels ? 'auto' : false,\n          formatter: (v) => {\n            let val = v\n              ? formatValue(v, {\n                  type: 'number',\n                  dps: updatedProps.dps,\n                  meta: updatedProps.displayAsPercentage ? undefined : props.metric.meta,\n                })\n              : null;\n            if (updatedProps.displayAsPercentage) {\n              val += '%';\n            }\n            return val;\n          },\n        },\n      },\n    };\n  }, [updatedProps, theme]);\n\n  return (\n    <Container {...updatedProps} className=\"overflow-y-hidden\">\n      <Line height=\"100%\" options={chartOptions} data={chartData} />\n    </Container>\n  );\n};\n"],"names":["jsx","Container","updatedProps","Line","chartOptions","chartData","theme","val","props","v","formatValue","lines","formatDateTooltips","label","context","setYAxisStepSize","P","axis","value","isMultiDimensionLine","fillGaps","useMemo","datasetsMeta","data","getStackedChartData","_b","_a","useTimeseries","i","setChartJSDefaults","k","useTheme","Component","ChartDataLabels","TimeScale","Filler","Legend","Tooltip","Title","x","LineElement","b","PointElement","h","LinearScale","y","CategoryScale","g","ChartJS"],"mappings":"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"}